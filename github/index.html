<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The House Edge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      /* Base styles for html, body, and root to ensure full height and visible background */
      html, body, #root {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      /* Ensure the App component's main div takes full height within #root */
      #root > div {
        height: 100%;
      }
      /* Hide scrollbar for Chrome, Safari and Opera */
      ::-webkit-scrollbar {
        display: none;
      }
      /* Custom font application */
      .font-outfit {
        font-family: 'Outfit', sans-serif;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Core React and ReactDOM Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <!-- ADDED: Correct ReactDOM URL for React 18 createRoot functionality -->
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transpilation in the browser -->
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Your React Application Components (transpiled by Babel) -->
    <script type="text/babel">
        // Destructure useState, useEffect, useRef from React global object
        const { useState, useEffect, useRef } = React;

        // --- Helper function for formatting time ---
        const formatTime = (totalSeconds) => {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        };

        /**
         * CardDisplay Component
         * Renders a single poker card with its rank and suit symbol.
         * Handles different sizes and invalid card strings.
         * @param {object} props - Component props.
         * @param {string} props.cardString - The string representation of the card (e.e.g., "AS" for Ace of Spades, "10H" for 10 of Hearts).
         * @param {boolean} [props.isLarge=false] - If true, renders the card in a larger size.
         */
        const CardDisplay = ({ cardString, isLarge = false }) => {
            // Validate the input card string length
            if (!cardString || cardString.length < 2 || cardString.length > 3) {
                return <span className="text-red-500">Invalid Card</span>;
            }

            // Extract rank and suit from the card string
            let rank = cardString.slice(0, -1); // All characters except the last one
            const suitChar = cardString.slice(-1).toLowerCase(); // Last character, converted to lowercase

            let suitSymbol;     // Symbol for the suit (♠, ♥, ♦, ♣)
            let textColorClass; // Tailwind CSS class for text color
            const cardBgClass = 'bg-white'; // Background color for the card

            // Determine suit symbol and color based on the suit character
            switch (suitChar) {
                // Modified: Use actual suit characters and apply red color for hearts and diamonds
                case 's': suitSymbol = '♠'; textColorClass = 'text-gray-900'; break; // Spades (black)
                case 'h': suitSymbol = '♥'; textColorClass = 'text-red-500'; break; // Hearts (red)
                case 'd': suitSymbol = '♦'; textColorClass = 'text-red-500'; break; // Diamonds (red)
                case 'c': suitSymbol = '♣'; textColorClass = 'text-gray-900'; break; // Clubs (black)
                default:  suitSymbol = '?'; textColorClass = 'text-gray-400'; // Fallback for invalid suit
            }

            // Standardize rank display (e.e.g., 'T' to '10', 'A' to 'A')
            switch (rank.toUpperCase()) {
                case 'T': rank = '10'; break; // 'T' for Ten
                case 'J': rank = 'J'; break; // Jack
                case 'Q': rank = 'Q'; break; // Queen
                case 'K': rank = 'K'; break; // King
                case 'A': rank = 'A'; break; // Ace
                default:
                    // Handle '10' as 'T' or numeric ranks '2'-'9'
                    if (rank.length === 2 && rank.startsWith('1')) {
                        rank = '10'; // Ensure '10' is correctly displayed
                    } else if (rank.length === 1 && !isNaN(parseInt(rank))) {
                        rank = rank; // Numeric ranks (2-9)
                    } else {
                        rank = '?'; // Fallback for invalid rank
                    }
            }

            // Base Tailwind CSS classes for card styling
            const baseClasses = `inline-flex items-center justify-center ${cardBgClass} rounded-md shadow-lg my-0.5 border border-gray-300 ${textColorClass} flex-shrink-0`;
            // Size-specific Tailwind CSS classes based on `isLarge` prop
            const sizeClasses = isLarge
                ? 'text-3xl px-1 py-2 w-[60px] h-[85px]' // Larger size for main display
                : 'text-base px-2 py-1 w-[40px] h-[60px]'; // Smaller size for input/list display

            return (
                <span className={`${baseClasses} ${sizeClasses}`}>
                    <span className="font-bold">{rank}</span>
                    <span className={`ml-0.5 ${isLarge ? 'text-xl' : 'text-lg'}`}>{suitSymbol}</span>
                </span>
            );
        };

        /**
         * HandDisplay Component
         * Renders a collection of poker cards (a hand).
         * Takes a space-separated string of cards and renders them using CardDisplay.
         * @param {object} props - Component props.
         * @param {string} props.handString - A space-separated string of cards (e.g., "AS KD 7C 2H 10S").
         * @param {boolean} [props.isLarge=false] - Passed directly to CardDisplay for individual card sizing.
         */
        const HandDisplay = ({ handString, isLarge = false }) => {
            // Return empty fragment if handString is invalid or empty
            if (!handString || typeof handString !== 'string') return <></>;

            // Regex to validate individual card tokens (e.g., "AS", "10H")
            const validCardRegex = /^([2-9]|10|[TJQKA])[shdcSHDC]$/i;
            // Split the hand string into individual card tokens, filter out invalid ones, and uppercase them
            const cardStrings = handString
                .split(' ') // Split by space
                .filter(token => token.trim() !== '' && validCardRegex.test(token.trim())) // Filter valid and non-empty tokens
                .map(token => token.trim().toUpperCase()); // Trim and uppercase each valid token

            return (
                <div className="flex flex-nowrap justify-center sm:justify-start items-center gap-2 overflow-x-auto min-w-max">
                    {/* Map over valid card strings and render CardDisplay for each */}
                    {cardStrings.map((card, index) => (
                        <CardDisplay key={card + index} cardString={card} isLarge={isLarge} />
                    ))}
                </div>
            );
        };

        /**
         * NumberSpinner Component
         * A reusable component for incrementing/decrementing a numeric value.
         * Used for setting timer duration, logo height, and logo offset.
         * @param {object} props - Component props.
         * @param {number} props.value - The current numeric value.
         * @param {number} props.min - The minimum allowed value.
         * @param {number} props.max - The maximum allowed value.
         * @param {number} props.step - The amount to increment/decrement by.
         * @param {function} props.onChange - Callback function when the value changes.
         * @param {string} props.theme - Current theme ('light' or 'dark') for styling.
         * @param {string} [props.widthClass='w-24'] - Tailwind class for width (e.e.g., 'w-24', 'w-32').
         * @param {string} [props.textSizeClass='text-xl'] - Tailwind class for text size (e.e.g., 'text-xl', 'text-lg').
         */
        const NumberSpinner = ({ value, min, max, step, onChange, theme, widthClass = 'w-24', textSizeClass = 'text-xl' }) => {
            // Function to increment the value, respecting the max limit
            const increment = () => onChange(Math.min(value + step, max));
            // Function to decrement the value, respecting the min limit
            const decrement = () => onChange(Math.max(value - step, min));

            // Tailwind CSS classes based on current theme for input and buttons
            const inputBgClass = theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100';
            const inputBorderClass = theme === 'dark' ? 'border-gray-600' : 'border-gray-300';
            const textColorClass = theme === 'dark' ? 'text-white' : 'text-gray-900';
            const buttonBaseClass = `px-3 py-1.5 rounded-lg font-bold text-xl transition-all duration-200 shadow-md`;
            const buttonEnabledClass = `bg-blue-600 hover:bg-blue-700 text-white`;
            const buttonDisabledClass = `bg-gray-400 text-gray-700 cursor-not-allowed`;

            return (
                <div className="flex items-center space-x-2">
                    {/* Decrement button */}
                    <button onClick={decrement} disabled={value <= min} className={`${buttonBaseClass} ${value <= min ? buttonDisabledClass : buttonEnabledClass}`}>-</button>
                    {/* Display current value */}
                    <div className={`${widthClass} px-4 py-2 text-center ${textSizeClass} rounded-lg ${inputBgClass} ${inputBorderClass} focus:border-yellow-500 focus:outline-none ${textColorClass} appearance-none [-moz-appearance:textfield] [&::-webkit-outer-spin-button]:-webkit-appearance-none [&::-webkit-inner-spin-button]:-webkit-appearance-none transition-colors duration-500`}>{value}</div>
                    {/* Increment button */}
                    <button onClick={increment} disabled={value >= max} className={`${buttonBaseClass} ${value >= max ? buttonDisabledClass : buttonEnabledClass}`}>+</button>
                </div>
            );
        };

        /**
         * HomeView Component
         * The initial landing page for the application.
         * Allows the user to choose between "High Hand Poker Timer" and "Tournament Clock".
         * @param {object} props - Component props.
         * @param {function} props.onSelectMode - Callback function to set the selected game mode.
         * @param {string} props.theme - Current theme ('light' or 'dark') for styling.
         * @param {string} props.headingTextColorClass - Tailwind class for heading text color.
         * @param {string} props.mainCardBgClass - Tailwind class for main card background.
         */
        const HomeView = ({ onSelectMode, theme, headingTextColorClass, mainCardBgClass }) => {
            console.log("HomeView component rendering");
            // URL for the image to display above the selection box
            const imageUrl = "https://i.imgur.com/bCHijGi.png"; // Updated logo URL

            return (
                <div className={`${mainCardBgClass} p-8 rounded-2xl shadow-2xl w-full max-w-md md:max-w-xl lg:max-w-2xl flex flex-col items-center justify-center transition-colors duration-500`}>
                    <img
                        src={imageUrl}
                        alt="High Hand Poker Logo"
                        className="mb-8 max-w-[80%] h-auto rounded-lg shadow-md"
                        onError={(e) => {
                            e.target.onerror = null; // Prevent infinite loop if placeholder also fails
                            e.target.src = 'https://placehold.co/300x150/cccccc/333333?text=Logo+Unavailable';
                            e.target.alt = "Logo could not be loaded";
                        }}
                    />
                    {/* Removed the "Select Game Mode" heading */}
                    <div className="flex flex-col space-y-6 w-full max-w-sm">
                        <button
                            onClick={() => onSelectMode('highHand')}
                            className="w-full px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold text-2xl rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105"
                        >
                            Cash Game
                        </button>
                        <button
                            onClick={() => onSelectMode('tournament')}
                            className="w-full px-8 py-4 bg-green-600 hover:bg-green-700 text-white font-semibold text-2xl rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105"
                        >
                            Tournament
                        </button>
                    </div>
                </div>
            );
        };

        // TournamentClockView: All states, effects, and functions specific to the Tournament Clock
        const TournamentClockView = ({ theme, appBgClass, mainCardBgClass, sectionBgClass, inputBgClass, inputBorderClass, subtextColorClass, placeholderColorClass, headingTextColorClass, onBackToHome, onThemeChange }) => {
            const [showSettings, setShowSettings] = useState(false);
            const [tournamentSettingsSubView, setTournamentSettingsSubView] = useState('menu');			// 'menu', 'blinds', 'payouts', 'logo', 'theme', 'chipSettings'
			const [tempPlayersRange, setTempPlayersRange] = useState(null);
			const [targetTournamentHours, setTargetTournamentHours] = useState(5);
			const [suggestedStack, setSuggestedStack] = useState(null);
			
			// NEW: one‑click builder controls
			const [highestChip, setHighestChip] = useState(1000);   // user’s biggest chip
			const [targetHours, setTargetHours] = useState(4);      // how many hours they want
			const [levelMinutes, setLevelMinutes] = useState(15);   // minutes per blind level.
			const [smallestChip, setSmallestChip] = useState(25);
			const [useAntes, setUseAntes] = useState(true);

            const [isFullscreen, setIsFullscreen] = useState(false);
            const [timeRemaining, setTimeRemaining] = useState(0); // Current level time remaining
            const [isRunning, setIsRunning] = useState(false);
            const [currentLevelIndex, setCurrentLevelIndex] = useState(0);
            // New state for editable tournament title
            const [tournamentTitle, setTournamentTitle] = useState(() => localStorage.getItem('tournamentTitle') || 'Tournament Clock');


            // New states for Payout structure
            const [numPlayers, setNumPlayers] = useState(() => parseInt(localStorage.getItem('tournamentNumPlayers') || '0'));
            const [rebuyAmount, setRebuyAmount] = useState(() => parseInt(localStorage.getItem('tournamentRebuyAmount') || '0'));
            const [buyInAmount, setBuyInAmount] = useState(() => parseInt(localStorage.getItem('tournamentBuyInAmount') || '0'));
            const [addOnAmount, setAddOnAmount] = useState(() => parseInt(localStorage.getItem('tournamentAddOnAmount') || '0'));
            const [rebuyCount, setRebuyCount] = useState(() => parseInt(localStorage.getItem('tournamentRebuyCount') || '0'));
            const [addOnCount, setAddOnCount] = useState(() => parseInt(localStorage.getItem('tournamentAddOnCount') || '0'));
            // Removed lateRegistrationCount state
            const [totalPrizePool, setTotalPrizePool] = useState(0);
			const clearPayoutCounts = () => {
				  if (!window.confirm('Clear number of players, rebuys, and add-ons?')) return;
				  setNumPlayers(0);
				  setRebuyCount(0);
				  setAddOnCount(0);
				};

            // Logo states for Tournament Clock
            const [showLogo, setShowLogo] = useState(true);
            const [logoHeightVh, setLogoHeightVh] = useState(10); // Changed default from 15 to 10
            const [customLogoUrl, setCustomLogoUrl] = useState('');
            const [logoTopOffset, setLogoTopOffset] = useState(2);
            // Changed default from 4vw (left) to 4vw (right) for top-right positioning
            const [logoRightOffset, setLogoRightOffset] = useState(4); 

            // New states for Chip Denominations (for Tournament Mode)
            const defaultChipDenominations = [
                { id: crypto.randomUUID(), color: '#FFFFFF', value: 1, quantity: 0 }, // White
                { id: crypto.randomUUID(), color: '#FF0000', value: 5, quantity: 0 },  // Red
                { id: crypto.randomUUID(), color: '#0000FF', value: 10, quantity: 0 }, // Blue
                { id: crypto.randomUUID(), color: '#008000', value: 25, quantity: 0 }, // Green
                { id: crypto.randomUUID(), color: '#000000', value: 100, quantity: 0 },// Black
            ];
            const [chipDenominations, setChipDenominations] = useState(() => {
                const savedChips = localStorage.getItem('tournamentChipDenominations');
                return savedChips ? JSON.parse(savedChips) : defaultChipDenominations;
            });
            const [showChipDisplay, setShowChipDisplay] = useState(() => {
                const savedDisplay = localStorage.getItem('showTournamentChipDisplay');
                return savedDisplay !== null ? JSON.parse(savedDisplay) : true; // Default to true
            });
			
            // State for the new tournament end timer
            const [showTournamentEndTime, setShowTournamentEndTime] = useState(() => {
                const savedShow = localStorage.getItem('showTournamentEndTime');
                return savedShow !== null ? JSON.parse(savedShow) : false; // Default to false
            });
            const [tournamentEndTimeDisplayMode, setTournamentEndTimeDisplayMode] = useState(() => {
                // Default to 'localTime' if not set, or load from localStorage
                return localStorage.getItem('tournamentEndTimeDisplayMode') || 'localTime';
            });
            const [tournamentEndTime, setTournamentEndTime] = useState(null); // Stores the Date object for end time
            const [remainingTournamentDuration, setRemainingTournamentDuration] = useState(0); // Total seconds remaining in tournament

            // Pre-defined colors for chip denominations
            const predefinedColors = [
                { name: 'White', hex: '#FFFFFF' },
                { name: 'Red', hex: '#FF0000' },
                { name: 'Green', hex: '#008000' },
                { name: 'Blue', hex: '#0000FF' },
                { name: 'Black', hex: '#000000' },
                { name: 'Gray', hex: '#808080' },
                { name: 'Orange', hex: '#FFA500' },
                { name: 'Pink', hex: '#FFC0CB' },
                { name: 'Yellow', hex: '#FFFF00' },
                { name: 'Purple', hex: '#800080' },
                { name: 'Light Blue', hex: '#ADD8E6' },
                { name: 'Cyan', hex: '#00FFFF' },
                { name: 'Magenta', hex: '#FF00FF' },
                { name: 'Lime', hex: '#00FF00' },
                { name: 'Teal', hex: '#008080' },
                { name: 'Indigo', hex: '#4B0082' },
                { name: 'Brown', hex: '#A52A2A' },
                { name: 'Gold', hex: '#FFD700' },
                { name: 'Silver', hex: '#C0C0C0' },
                { name: 'Maroon', hex: '#800000' },
            ];

            // DEFAULT LOGO URL
            const defaultLogoUrl = "https://i.imgur.com/bCHijGi.png"; // Updated logo URL
            const logoToDisplay = customLogoUrl || defaultLogoUrl;


            // Default blind structure
            const defaultLevels = [
                { id: '1', sb: 100, bb: 200, ante: 0, duration: 10, isBreak: false },
                { id: '2', sb: 200, bb: 400, ante: 0, duration: 10, isBreak: false },
                { id: '3', sb: 300, bb: 600, ante: 0, duration: 10, isBreak: false },
                { id: 'break1', isBreak: true, duration: 10, name: "Break 1" },
                { id: '4', sb: 400, bb: 800, ante: 0, duration: 10, isBreak: false },
            ];

            // State for blind levels
            const [levels, setLevels] = useState(() => {
                const savedLevels = localStorage.getItem('tournamentLevels');
                return savedLevels ? JSON.parse(savedLevels) : defaultLevels;
            });

            // State for payout structure
            const [payoutStructure, setPayoutStructure] = useState(() => {
                const savedPayouts = localStorage.getItem('tournamentPayoutStructure');
                return savedPayouts ? JSON.parse(savedPayouts) : [];
            });

            // New state for rebuy period end level
            const [rebuyEndsAfterLevelIndex, setRebuyEndsAfterLevelIndex] = useState(() => {
                const savedIndex = localStorage.getItem('rebuyEndsAfterLevelIndex');
                return savedIndex !== null ? parseInt(savedIndex) : -1; // -1 means no rebuy period / indefinite
            });
            // State for the calculated rebuy timer
            const [rebuyTimeRemaining, setRebuyTimeRemaining] = useState(0);

			// Blind structure presets
			const [blindPresets, setBlindPresets] = useState(() => {
			  const saved = localStorage.getItem('tournamentBlindPresets');
			  return saved ? JSON.parse(saved) : [];
			});
			const [activePresetId, setActivePresetId] = useState(null);
			const [newPresetName, setNewPresetName] = useState('');

			
            const timerIntervalRef = useRef(null);
            const audioRef = useRef(null); // For sound effects
            const prevLevelIndex = useRef(currentLevelIndex); // Ref to track actual level changes


            // Load levels and payout structure from localStorage on mount
            useEffect(() => {
                const savedLevels = localStorage.getItem('tournamentLevels');
                if (savedLevels) {
                    try {
                        const parsedLevels = JSON.parse(savedLevels);
                        if (Array.isArray(parsedLevels) && parsedLevels.length > 0) {
                            setLevels(parsedLevels);
                        }
                    } catch (e) {
                        console.error("Failed to parse levels from localStorage:", e);
                    }
                }
                const savedPayouts = localStorage.getItem('tournamentPayoutStructure');
                if (savedPayouts) {
                    try {
                        const parsedPayouts = JSON.parse(savedPayouts);
                        if (Array.isArray(parsedPayouts)) {
                            setPayoutStructure(parsedPayouts);
                        }
                    } catch (e) {
                        console.error("Failed to parse payouts from localStorage:", e);
                    }
                }
                // Load new states
                setNumPlayers(parseInt(localStorage.getItem('tournamentNumPlayers') || '0'));
                setRebuyAmount(parseInt(localStorage.getItem('tournamentRebuyAmount') || '0'));
                setBuyInAmount(parseInt(localStorage.getItem('tournamentBuyInAmount') || '0'));
                setAddOnAmount(parseInt(localStorage.getItem('tournamentAddOnAmount') || '0'));
                setRebuyCount(parseInt(localStorage.getItem('tournamentRebuyCount') || '0'));
                setAddOnCount(parseInt(localStorage.getItem('tournamentAddOnCount') || '0'));
                // Removed lateRegistrationCount loading

                // Load logo settings for Tournament Clock
                const savedShowLogo = localStorage.getItem('tournamentShowLogo');
                if (savedShowLogo !== null) setShowLogo(JSON.parse(savedShowLogo));
                const savedLogoHeight = localStorage.getItem('tournamentLogoHeightVh');
                if (savedLogoHeight !== null) setLogoHeightVh(parseInt(savedLogoHeight));
                const savedCustomLogoUrl = localStorage.getItem('tournamentCustomLogoUrl');
                if (savedCustomLogoUrl) setCustomLogoUrl(savedCustomLogoUrl);
                const savedLogoTopOffset = localStorage.getItem('tournamentLogoTopOffset');
                if (savedLogoTopOffset !== null) setLogoTopOffset(parseInt(savedLogoTopOffset));
                // Load right offset for Tournament Clock
                const savedLogoRightOffset = localStorage.getItem('tournamentLogoRightOffset');
                if (savedLogoRightOffset !== null) setLogoRightOffset(parseInt(savedLogoRightOffset));
                // Load tournament title
                const savedTitle = localStorage.getItem('tournamentTitle');
                if (savedTitle) setTournamentTitle(savedTitle);
                // Load Chip Denominations for Tournament Mode
                const savedChipDenominations = localStorage.getItem('tournamentChipDenominations');
                if (savedChipDenominations) {
                    try {
                        const parsedChips = JSON.parse(savedChipDenominations);
                        if (Array.isArray(parsedChips)) {
                            setChipDenominations(parsedChips);
                        }
                    } catch (e) {
                        console.error("Failed to parse tournamentChipDenominations from localStorage:", e);
                    }
                }
                const savedShowChipDisplay = localStorage.getItem('showTournamentChipDisplay');
                if (savedShowChipDisplay !== null) setShowChipDisplay(JSON.parse(savedShowChipDisplay));
                // Load showTournamentEndTime
                const savedShowTournamentEndTime = localStorage.getItem('showTournamentEndTime');
                if (savedShowTournamentEndTime !== null) setShowTournamentEndTime(JSON.parse(savedShowTournamentEndTime));
                // Load tournamentEndTimeDisplayMode
                const savedDisplayMode = localStorage.getItem('tournamentEndTimeDisplayMode');
                if (savedDisplayMode) setTournamentEndTimeDisplayMode(savedDisplayMode);

            }, []);
		const [chipPlayers, setChipPlayers] = useState(10);	
			

useEffect(() => {
  // Need levels and chips
  if (!chipDenominations || chipDenominations.length === 0) {
    setSuggestedStack(null);
    return;
  }
  if (!levels || levels.length === 0) {
    setSuggestedStack(null);
    return;
  }

  // Sum non-break durations to get total time
  const totalMinutes = levels
    .filter(l => !l.isBreak)
    .reduce((sum, l) => sum + (l.duration || 0), 0);

  if (totalMinutes <= 0) {
    setSuggestedStack(null);
    return;
  }

  const totalHours = totalMinutes / 60;

  // Highest chip
  const highestChip = Math.max(...chipDenominations.map(c => c.value || 0));
  if (!highestChip || highestChip <= 0) {
    setSuggestedStack(null);
    return;
  }

  // First non-break level’s BB
  const firstLevel = levels.find(l => !l.isBreak);
  if (!firstLevel || !firstLevel.bb) {
    setSuggestedStack(null);
    return;
  }
  const baseBB = firstLevel.bb;

  // Target BB count based on totalHours
  const targetBBs = 60 + totalHours * 20; // tweak later

  let stack = baseBB * targetBBs;

// Round to nearest 5 × big blind
const roundingUnit = baseBB * 5;
stack = Math.round(stack / roundingUnit) * roundingUnit;

  setSuggestedStack(stack);
}, [chipDenominations, levels]);


            // Save levels and payout structure to localStorage whenever they change
            useEffect(() => {
                localStorage.setItem('tournamentLevels', JSON.stringify(levels));
            }, [levels]);

			useEffect(() => {
			  localStorage.setItem('tournamentBlindPresets', JSON.stringify(blindPresets));
			}, [blindPresets]);


            useEffect(() => {
                localStorage.setItem('tournamentPayoutStructure', JSON.stringify(payoutStructure));
            }, [payoutStructure]);

            // Save new states to localStorage whenever they change
            useEffect(() => {
                localStorage.setItem('tournamentNumPlayers', numPlayers.toString());
            }, [numPlayers]);

            useEffect(() => {
                localStorage.setItem('tournamentRebuyAmount', rebuyAmount.toString());
            }, [rebuyAmount]);

            useEffect(() => {
                localStorage.setItem('tournamentBuyInAmount', buyInAmount.toString());
            }, [buyInAmount]);

            useEffect(() => {
                localStorage.setItem('tournamentAddOnAmount', addOnAmount.toString());
            }, [addOnAmount]);

            useEffect(() => {
                localStorage.setItem('tournamentRebuyCount', rebuyCount.toString());
            }, [rebuyCount]);

            useEffect(() => {
                localStorage.setItem('tournamentAddOnCount', addOnCount.toString());
            }, [addOnCount]);

            // Removed lateRegistrationCount saving

            // Save rebuy ends after level index
            useEffect(() => {
                localStorage.setItem('rebuyEndsAfterLevelIndex', rebuyEndsAfterLevelIndex.toString());
            }, [rebuyEndsAfterLevelIndex]);

            // Save logo settings for Tournament Clock
            useEffect(() => {
                localStorage.setItem('tournamentShowLogo', JSON.stringify(showLogo));
                localStorage.setItem('tournamentLogoHeightVh', logoHeightVh.toString());
                if (customLogoUrl) { localStorage.setItem('tournamentCustomLogoUrl', customLogoUrl); } else { localStorage.removeItem('tournamentCustomLogoUrl'); }
                localStorage.setItem('tournamentLogoTopOffset', logoTopOffset.toString());
                localStorage.setItem('tournamentLogoRightOffset', logoRightOffset.toString()); // Save right offset
            }, [showLogo, logoHeightVh, customLogoUrl, logoTopOffset, logoRightOffset]);

            // Save tournament title to localStorage
            useEffect(() => {
                localStorage.setItem('tournamentTitle', tournamentTitle);
            }, [tournamentTitle]);

            // Save Chip Denominations for Tournament Mode
            useEffect(() => {
                localStorage.setItem('tournamentChipDenominations', JSON.stringify(chipDenominations));
                localStorage.setItem('showTournamentChipDisplay', JSON.stringify(showChipDisplay));
            }, [chipDenominations, showChipDisplay]);

            // Save showTournamentEndTime and tournamentEndTimeDisplayMode
            useEffect(() => {
                localStorage.setItem('showTournamentEndTime', JSON.stringify(showTournamentEndTime));
            }, [showTournamentEndTime]);
            useEffect(() => {
                localStorage.setItem('tournamentEndTimeDisplayMode', tournamentEndTimeDisplayMode);
            }, [tournamentEndTimeDisplayMode]);


            // Calculate total prize pool whenever relevant values change
            useEffect(() => {
                // Initial buy-ins + rebuys + add-ons
                const calculatedPrizePool = (numPlayers * buyInAmount) + (rebuyCount * rebuyAmount) + (addOnCount * addOnAmount);
                setTotalPrizePool(calculatedPrizePool);
            }, [numPlayers, buyInAmount, rebuyAmount, addOnAmount, rebuyCount, addOnCount]);

            // Effect 1: Initialize/Reset time when level changes
            useEffect(() => {
                if (levels.length === 0) {
                    setTimeRemaining(0);
                    setIsRunning(false);
                    return;
                }

                // Check if currentLevelIndex has actually changed, not just a re-render
                if (currentLevelIndex !== prevLevelIndex.current) {
                    const newLevelDuration = levels[currentLevelIndex]?.duration || 0;
                    setTimeRemaining(newLevelDuration * 60);
                }
                // Also set time if it's the very first load and time is 0
                else if (timeRemaining === 0 && currentLevelIndex === 0 && levels[0]) {
                    setTimeRemaining(levels[0].duration * 60);
                }

                prevLevelIndex.current = currentLevelIndex; // Update ref for next render
            }, [currentLevelIndex, levels]); // Only re-run when level index or levels array changes
			// Auto-recalculate suggested stack when structure or target hours change
			useEffect(() => {
  if (levels.length === 0) {
    setSuggestedStack(null);
    return;
  }
  calculateSuggestedStack();
}, [levels, targetTournamentHours]);



            // Effect 2: Manage the countdown interval based on isRunning and timeRemaining
            useEffect(() => {
                if (isRunning && timeRemaining > 0) {
                    timerIntervalRef.current = setInterval(() => {
                        setTimeRemaining(prev => {
                            if (prev <= 1) { // Time runs out
                                clearInterval(timerIntervalRef.current);
                                if (audioRef.current) {
                                    audioRef.current.play();
                                }
                                // If current level is a break, pause the timer instead of auto-advancing
                                if (currentLevel && currentLevel.isBreak) {
                                    setIsRunning(false); // Pause the timer
                                    return 0; // Keep time at 0 until manually advanced
                                } else if (currentLevelIndex < levels.length - 1) {
                                    // If not a break, auto-advance to next level
                                    setCurrentLevelIndex(currentLevelIndex + 1); // This will trigger Effect 1 to set new time
                                    return 0; // Set to 0 temporarily, will be overwritten by Effect 1
                                } else {
                                    setIsRunning(false); // End of tournament
                                    return 0;
                                }
                            }
                            return prev - 1;
                        });
                    }, 1000);
                } else {
                    // If not running or time is 0, ensure interval is cleared
                    clearInterval(timerIntervalRef.current);
                }
                return () => clearInterval(timerIntervalRef.current); // Cleanup on unmount/re-render
            }, [isRunning, timeRemaining, currentLevelIndex, levels, currentLevel]); // Depend on these to react to changes

            // Effect 3: Calculate rebuy time remaining
            useEffect(() => {
                if (levels.length === 0 || rebuyEndsAfterLevelIndex === -1 || currentLevelIndex > rebuyEndsAfterLevelIndex) {
                    setRebuyTimeRemaining(0);
                    return;
                }

                let cumulativeRebuyTime = 0;
                // Add remaining time in the current level
                cumulativeRebuyTime += timeRemaining;

                // Add full duration of all subsequent levels up to the rebuy end level
                for (let i = currentLevelIndex + 1; i <= rebuyEndsAfterLevelIndex && i < levels.length; i++) {
                    cumulativeRebuyTime += levels[i].duration * 60;
                }

                setRebuyTimeRemaining(cumulativeRebuyTime);

            }, [currentLevelIndex, timeRemaining, levels, rebuyEndsAfterLevelIndex]);

            // Effect 4: Calculate total tournament remaining duration and end time
            useEffect(() => {
                if (levels.length === 0) {
                    setRemainingTournamentDuration(0);
                    setTournamentEndTime(null);
                    return;
                }

                let totalRemaining = timeRemaining; // Start with current level's remaining time

                // Add durations of all future levels
                for (let i = currentLevelIndex + 1; i < levels.length; i++) {
                    totalRemaining += levels[i].duration * 60;
                }
                setRemainingTournamentDuration(totalRemaining);

                if (totalRemaining > 0) {
                    const now = new Date();
                    const endTime = new Date(now.getTime() + totalRemaining * 1000);
                    setTournamentEndTime(endTime);
                } else {
                    setTournamentEndTime(null);
                }

            }, [currentLevelIndex, timeRemaining, levels]);

			//BlindStructure preset
				const handleSavePreset = () => {
				  if (!newPresetName.trim() || levels.length === 0) return;
				  const id = crypto.randomUUID();
				  const preset = { id, name: newPresetName.trim(), levels };
				  setBlindPresets(prev => [...prev, preset]);
				  setActivePresetId(id);
				  setNewPresetName('');
				};

				const handleLoadPreset = (id) => {
  const preset = blindPresets.find((p) => p.id === id);
  if (!preset) return;

  setLevels(preset.levels);
  setActivePresetId(id);

  // NEW: force suggested stack recompute based on the loaded preset
  calculateSuggestedStack();
};

				const handleRenamePreset = (id, newName) => {
				  setBlindPresets(prev =>
					prev.map(p => (p.id === id ? { ...p, name: newName } : p))
				  );
				};

				const handleDeletePreset = (id) => {
				  setBlindPresets(prev => prev.filter(p => p.id !== id));
				  if (activePresetId === id) setActivePresetId(null);
				};


            // Fullscreen change listener
            useEffect(() => {
                const handleFullscreenChange = () => setIsFullscreen(!!document.fullscreenElement);
                document.addEventListener('fullscreenchange', handleFullscreenChange);
                document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
                document.addEventListener('mozfullscreenchange', handleFullscreenChange);
                document.addEventListener('MSFullscreenChange', handleFullscreenChange);
                return () => {
                    document.removeEventListener('fullscreenchange', handleFullscreenChange);
                    document.removeEventListener('webkitfullscreenchange', handleFullscreenChange); // Fixed typo here
                    document.removeEventListener('mozfullscreenchange', handleFullscreenChange);
                    document.removeEventListener('MSFullscreenChange', handleFullscreenChange);
                };
            }, []);

            const toggleFullscreen = () => {
                try {
                    if (!document.fullscreenElement) {
                        if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
                        else if (document.documentElement.mozRequestFullScreen) document.documentElement.mozRequestFullScreen();
                        else if (document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
                        else if (document.documentElement.msRequestFullscreen) document.documentElement.msRequestFullscreen();
                    } else {
                        if (document.exitFullscreen) document.exitFullscreen();
                        else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                        else if (document.webkitExitFullscreen) document.exitFullscreen();
                        else if (document.documentElement.msExitFullscreen) document.documentElement.msExitFullscreen();
                    }
                } catch (error) { /* console.error("Fullscreen API error:", error); */ }
            };

            const startTimer = () => {
                // If starting from 0 (e.g., first run or after reset) set the time for the current level
                if (timeRemaining === 0 && levels.length > 0 && levels[currentLevelIndex]) {
                    setTimeRemaining(levels[currentLevelIndex].duration * 60);
                }
                setIsRunning(true);
            };

            const pauseTimer = () => setIsRunning(false);
			const calculateSuggestedStack = () => {
				if (levels.length === 0 || !levels[0]?.bigBlind) return;
			const totalMins = levels.reduce((s, l) => s + l.duration, 0);
			const targetMins = targetTournamentHours * 60;
			const idealBB = Math.round((targetMins / totalMins) * 80);
			const clean = [5000,8000,10000,12000,15000,20000,25000,30000,50000];
			const closest = clean.reduce((a,b) => 
				Math.abs(b - idealBB * levels[0].bigBlind) < Math.abs(a - idealBB * levels[0].bigBlind) ? b : a
			);
			setSuggestedStack({
				chips: closest,
				bb: idealBB,
				duration: `${targetTournamentHours}h target`
			});
			};
			const formatBlind = (value) => {
			  if (value == null) return '';
			  const n = Number(value) || 0;
			  return n.toLocaleString(); // adds commas at 1,000 and above
			};
            const nextLevel = () => {
                setIsRunning(false); // Pause when manually skipping levels
                if (currentLevelIndex < levels.length - 1) {
                    setCurrentLevelIndex(prevIndex => prevIndex + 1);
                } else {
                    // No more levels, just stop
                    setIsRunning(false);
                }
            };

            const prevLevel = () => {
                setIsRunning(false); // Pause when manually skipping levels
                if (currentLevelIndex > 0) {
                    setCurrentLevelIndex(prevIndex => prevIndex - 1);
                }
            };

            const resetTournament = () => {
                setIsRunning(false);
                // Only reset the time for the current level
                if (levels.length > 0 && levels[currentLevelIndex]) {
                    setTimeRemaining(levels[currentLevelIndex].duration * 60);
                } else {
                    setTimeRemaining(0);
                }
            };

            const handleRebuy = () => {
                setRebuyCount(prevCount => prevCount + 1);
            };

            const handleAddOn = () => {
                setAddOnCount(prevCount => prevCount + 1);
            };

            // Modified handleLateRegistrationBuyIn to increment numPlayers
            const handleLateRegistrationBuyIn = () => {
                setNumPlayers(prevCount => prevCount + 1);
            };

            const addLevel = () => {
                setLevels(prevLevels => [
                    ...prevLevels,
                    { id: crypto.randomUUID(), sb: 100, bb: 200, ante: 0, duration: 10, isBreak: false }
                ]);
            };

            const updateLevel = (id, field, value) => {
                setLevels(prevLevels =>
                    prevLevels.map(level =>
                        level.id === id ? { ...level, [field]: value } : level
                    )
                );
            };

            const deleteLevel = (id) => {
                setLevels(prevLevels => prevLevels.filter(level => level.id !== id));
            };

            const handleSaveLevels = (newLevels) => {
                setLevels(newLevels);
                // After saving, reset current level time based on the new structure
                if (newLevels.length > 0) {
                    setTimeRemaining(newLevels[currentLevelIndex]?.duration * 60 || 0);
                } else {
                    setTimeRemaining(0);
                }
                setShowSettings(false); // Close settings after saving
            };
			
            // Helper function to normalize payout percentages to sum up to targetSum (default 100)
            const normalizePayouts = (payouts, changedId = null) => {
                if (payouts.length === 0) {
                    return [];
                }

                let totalAdjustablePercentage = 100;
                let sumOfFixedPercentages = 0;
                let fixedPayouts = [];
                let adjustablePayouts = [];

                // Separate payouts into fixed (recently changed) and adjustable (others)
                payouts.forEach(payout => {
                    if (payout.id === changedId) {
                        fixedPayouts.push(payout);
                        sumOfFixedPercentages += payout.percentage;
                    } else {
                        adjustablePayouts.push(payout);
                    }
                });

                // Calculate the remaining percentage to distribute among adjustable payouts
                totalAdjustablePercentage = Math.max(0, 100 - sumOfFixedPercentages);

                const sumOfCurrentAdjustablePercentages = adjustablePayouts.reduce((sum, p) => sum + p.percentage, 0);

                let scaledAdjustablePayouts = [];
                if (sumOfCurrentAdjustablePercentages > 0 && adjustablePayouts.length > 0) {
                    // Scale adjustable payouts to fit the remaining percentage, rounding to whole numbers
                    const scaleFactor = totalAdjustablePercentage / sumOfCurrentAdjustablePercentages;
                    scaledAdjustablePayouts = adjustablePayouts.map(p => ({
                        ...p,
                        percentage: Math.round(p.percentage * scaleFactor)
                    }));
                } else if (adjustablePayouts.length > 0) {
                    // If no current adjustable percentages, distribute equally among them, rounding to whole numbers
                    const equalShare = totalAdjustablePercentage / adjustablePayouts.length;
                    scaledAdjustablePayouts = adjustablePayouts.map(p => ({
                        ...p,
                        percentage: Math.round(equalShare)
                    }));
                }

                // Combine fixed and scaled adjustable payouts
                const newPayouts = [...fixedPayouts, ...scaledAdjustablePayouts];

                // Re-check and ensure exactly 100% due to floating point inaccuracies
                const finalSum = newPayouts.reduce((sum, p) => sum + p.percentage, 0);
                if (finalSum !== 100 && newPayouts.length > 0) {
                    const diff = 100 - finalSum;
                    // Find the payout that was most recently changed (if any), or the first one
                    const targetPayout = fixedPayouts.length > 0 ? fixedPayouts[0] : newPayouts[0];
                    if (targetPayout) {
                        targetPayout.percentage = Math.round(targetPayout.percentage + diff);
                    }
                }

                return newPayouts;
            };

            const addPayoutPlace = () => {
                setPayoutStructure(prevPayouts => {
                    const nextPlace = (prevPayouts.length > 0
                        ? Math.max(...prevPayouts.map(p => p.place))
                        : 0) + 1;
                    const newPayouts = [...prevPayouts, { id: crypto.randomUUID(), place: nextPlace, percentage: 0 }];
                    return normalizePayouts(newPayouts); // New places are initially adjustable
                });
            };

            const updatePayoutPlace = (id, field, value) => {
                setPayoutStructure(prevPayouts => {
                    const updatedPayouts = prevPayouts.map(payout =>
                        payout.id === id ? { ...payout, [field]: value } : payout
                    );
                    if (field === 'percentage') {
                        return normalizePayouts(updatedPayouts, id); // Treat this as the "fixed" one
                    }
                    return updatedPayouts; // For other fields like 'place', no normalization needed
                });
            };

            const updatePayoutPlaceAmount = (id, newAmount) => {
                setPayoutStructure(prevPayouts => {
                    const total = totalPrizePool;
                    let newPercentage = (total > 0) ? (newAmount / total) * 100 : 0;
                    newPercentage = Math.max(0, Math.min(100, newPercentage)); // Cap percentage between 0 and 100

                    const updatedPayouts = prevPayouts.map(payout =>
                        payout.id === id ? { ...payout, percentage: Math.round(newPercentage) } : payout
                    );
                    return normalizePayouts(updatedPayouts, id); // Normalize, fixing this one
                });
            };

            const deletePayoutPlace = (id) => {
                setPayoutStructure(prevPayouts => {
                    const remainingPayouts = prevPayouts.filter(payout => payout.id !== id);
                    return normalizePayouts(remainingPayouts); // Normalize the remaining ones
                });
            };
			
			const clearPayouts = () => {
			  if (!window.confirm('Clear ALL payout places?')) return;
			  setPayoutStructure([]);
			};


            // Chip Denomination handlers (for Tournament Mode)
            const addChipDenomination = () => {
                setChipDenominations(prevChips => [
                    ...prevChips,
                    { id: crypto.randomUUID(), color: '#CCCCCC', value: 0, quantity: 0 } // Default new chip
                ]);
            };

            const updateChipDenomination = (id, field, value) => {
                setChipDenominations(prevChips =>
                    prevChips.map(chip =>
                        chip.id === id ? { ...chip, [field]: value } : chip
                    )
                );
            };

            const deleteChipDenomination = (id) => {
                setChipDenominations(prevChips => prevChips.filter(chip => chip.id !== id));
            };

            // Modified getLogoStyle to accept either left or right offset
            const getLogoStyle = (topOffset, leftOffset, rightOffset) => {
                const style = {
                    top: `${topOffset}vh`,
                    position: 'absolute'
                };
                if (leftOffset !== undefined) {
                    style.left = `${leftOffset}vw`;
                } else if (rightOffset !== undefined) {
                    style.right = `${rightOffset}vw`;
                }
                return style;
            };

const formatHoursMinutes = (totalSeconds) => {
  if (!totalSeconds || totalSeconds <= 0) return '0 min';
  const totalMinutes = Math.floor(totalSeconds / 60);
  const hours = Math.floor(totalMinutes / 60);
  const minutes = totalMinutes % 60;
  if (hours > 0) {
    return `${hours} hr${hours > 1 ? 's' : ''} ${minutes} min`;
  }
  return `${minutes} min`;
};


		const [showSmartBuilder, setShowSmartBuilder] = useState(false);
        const currentLevel = levels[currentLevelIndex];
		const [pendingBreakAfterIndex, setPendingBreakAfterIndex] = useState(null);
//// Computing if the suggested starting stack is able to fit with the number of players and the available chips///
						

const tryDistributeForTarget = (targetStack, chipPlayers, chipDenominations) => {
  if (!targetStack || targetStack <= 0) return null;
  if (!chipPlayers || chipPlayers <= 0) return null;
  if (!chipDenominations || chipDenominations.length === 0) return null;

  const chipsSorted = [...chipDenominations]
    .filter(c => c.value > 0 && c.quantity > 0)
    .sort((a, b) => a.value - b.value); // small → big

  if (chipsSorted.length === 0) return null;

  const totalPlayers = chipPlayers;
  const perPlayerCapByChip = chipsSorted.map(chip =>
    Math.floor(chip.quantity / totalPlayers)
  );
  if (perPlayerCapByChip.every(cap => cap <= 0)) return null;

  const perPlayer = {};
  let remainingValue = targetStack;

  // Pass 1: prioritize smaller chips
  for (let i = 0; i < chipsSorted.length; i++) {
    const chip = chipsSorted[i];
    const capPerPlayer = perPlayerCapByChip[i];
    if (capPerPlayer <= 0) {
      perPlayer[chip.id] = 0;
      continue;
    }

    const idealCount = Math.floor(remainingValue / chip.value);
    const give = Math.max(0, Math.min(idealCount, capPerPlayer));
    perPlayer[chip.id] = give;
    remainingValue -= give * chip.value;
  }

  // Pass 2: use bigger chips to top off if still short
  for (let i = chipsSorted.length - 1; i >= 0 && remainingValue > 0; i--) {
    const chip = chipsSorted[i];
    const capPerPlayer = perPlayerCapByChip[i];
    const current = perPlayer[chip.id] || 0;
    const remainingCap = capPerPlayer - current;
    if (remainingCap <= 0) continue;

    const maxNeeded = Math.floor(remainingValue / chip.value);
    const add = Math.min(remainingCap, maxNeeded);
    if (add > 0) {
      perPlayer[chip.id] = current + add;
      remainingValue -= add * chip.value;
    }
  }

  if (remainingValue !== 0) return null; // require exact hit

  return { perPlayer, chipsSorted };
};

// Try to adjust a valid distribution to hit the ideal exactly,
// by removing and swapping chips, staying within 0..cap for each chip.
const rebalanceToIdeal = (ideal, distribution, chipPlayers, chipDenominations) => {
  if (!distribution) return null;

  const { perPlayer, chipsSorted } = distribution;

  // Recompute caps to enforce limits
  const totalPlayers = chipPlayers;
  const perPlayerCapByChip = chipsSorted.map(chip =>
    Math.floor(chip.quantity / totalPlayers)
  );

  // Current total per player
  let currentTotal = chipsSorted.reduce((sum, chip, idx) => {
    const cnt = perPlayer[chip.id] || 0;
    return sum + cnt * chip.value;
  }, 0);

  const diff = currentTotal - ideal;
  if (diff === 0) {
    // Already exact
    return { perPlayer, chipsSorted, effectiveStack: ideal, idealStack: ideal };
  }

  // Only handle the common case where we are ABOVE the ideal (e.g., 2,000 > 1,800)
  if (diff <= 0) return null;

  // Simple heuristic: try removing higher‑value chips and compensating
  // with smaller ones, constrained by caps.

  // Make a mutable copy
  const newPerPlayer = { ...perPlayer };
  let remainingOverage = diff;

  // Step A: try just removing high chips without adding small ones
  for (let i = chipsSorted.length - 1; i >= 0 && remainingOverage > 0; i--) {
    const chip = chipsSorted[i];
    const have = newPerPlayer[chip.id] || 0;
    if (have <= 0) continue;

    const maxRemovableValue = have * chip.value;
    const toRemove = Math.min(
      have,
      Math.floor(remainingOverage / chip.value)
    );
    if (toRemove > 0) {
      newPerPlayer[chip.id] = have - toRemove;
      remainingOverage -= toRemove * chip.value;
    }
  }

  if (remainingOverage === 0) {
    // We hit the ideal just by dropping some bigger chips.
    return {
      perPlayer: newPerPlayer,
      chipsSorted,
      effectiveStack: ideal,
      idealStack: ideal,
    };
  }

  // Step B (lightweight): if still above, try small compensation swaps:
  // for each big chip, see if we can remove 1 and add small chips whose total value
  // is slightly less, inching toward the ideal. This is a bounded local search,
  // not a full knapSack.

  // For safety, limit number of swap attempts
  const maxSwaps = 50;
  let swaps = 0;

  while (remainingOverage > 0 && swaps < maxSwaps) {
    let improved = false;

    for (let i = chipsSorted.length - 1; i >= 0 && remainingOverage > 0; i--) {
      const big = chipsSorted[i];
      const haveBig = newPerPlayer[big.id] || 0;
      if (haveBig <= 0) continue;

      // Try removing one big chip
      const removeValue = big.value;
      const targetDrop = Math.min(removeValue, remainingOverage);

      // Now add smaller chips up to (removeValue - targetDrop),
      // staying within caps.
      const smallNewPerPlayer = { ...newPerPlayer, [big.id]: haveBig - 1 };
      let smallAddedValue = 0;

      for (let j = 0; j < i; j++) {
        const small = chipsSorted[j];
        const cap = perPlayerCapByChip[j];
        const already = smallNewPerPlayer[small.id] || 0;
        const remainingCap = cap - already;
        if (remainingCap <= 0) continue;

        const maxWeCanAdd = Math.floor(
          (removeValue - targetDrop - smallAddedValue) / small.value
        );
        const toAdd = Math.min(remainingCap, maxWeCanAdd);
        if (toAdd > 0) {
          smallNewPerPlayer[small.id] = already + toAdd;
          smallAddedValue += toAdd * small.value;
        }
      }

      const netDrop = removeValue - smallAddedValue;
      if (netDrop > 0 && netDrop <= remainingOverage) {
        // Accept this swap
        Object.assign(newPerPlayer, smallNewPerPlayer);
        remainingOverage -= netDrop;
        swaps += 1;
        improved = true;
      }
    }

    if (!improved) break; // no better swap found
  }

  if (remainingOverage === 0) {
    return {
      perPlayer: newPerPlayer,
      chipsSorted,
      effectiveStack: ideal,
      idealStack: ideal,
    };
  }

  // Could not rebalance exactly
  return null;
};


const computePerPlayerChipDistribution = () => {
  const ideal =
    suggestedStack && typeof suggestedStack === 'object'
      ? suggestedStack.chips
      : suggestedStack;

  if (!ideal || ideal <= 0) return null;
  if (!chipPlayers || chipPlayers <= 0) return null;
  if (!chipDenominations || chipDenominations.length === 0) return null;

  const positiveValues = chipDenominations
    .map(c => c.value)
    .filter(v => v > 0);
  if (positiveValues.length === 0) return null;

  const step = Math.min(...positiveValues);

  const maxSpan = step * 400;

  let bestResult = null;
  let bestDiff = Infinity;

  for (let delta = 0; Math.abs(delta) <= maxSpan; ) {
    const target = ideal + delta;
    if (target > 0) {
      const result = tryDistributeForTarget(target, chipPlayers, chipDenominations);
      if (result) {
        const diff = Math.abs(target - ideal);
        if (diff < bestDiff) {
          bestDiff = diff;
          bestResult = {
            ...result,
            effectiveStack: target,
            idealStack: ideal,
          };
          if (diff === 0) break;
        }
      }
    }

    if (delta >= 0) {
      delta = -(delta + step);
    } else {
      delta = -delta;
    }
  }

  if (!bestResult) return null;

  // NEW: try to rebalance down to the ideal if we ended above it
  const rebalanced = rebalanceToIdeal(
    ideal,
    bestResult,
    chipPlayers,
    chipDenominations
  );

  return rebalanced || bestResult;
};





const chipDistribution = computePerPlayerChipDistribution();

const idealStack =
  chipDistribution?.idealStack ??
  (suggestedStack && typeof suggestedStack === 'object'
    ? suggestedStack.chips
    : suggestedStack);

const effectiveStack = chipDistribution?.effectiveStack ?? idealStack;

const totalValuePerPlayer = chipDistribution
  ? chipDistribution.chipsSorted.reduce((sum, chip) => {
      const count = chipDistribution.perPlayer[chip.id] || 0;
      return sum + count * chip.value;
    }, 0)
  : 0;


const getPerPlayerCountForChip = (chipId) => {
  if (!chipDistribution) return null;
  return chipDistribution.perPlayer[chipId] ?? 0;
};
            const nextLevelData = levels[currentLevelIndex + 1];
				// NEW: build a blind structure with at most 20 levels,
						// shaped by highestChip, targetHours, levelMinutes, and speed.
						// Build blind structure based on user parameters
					const buildBlindLevels = (speed = 'regular') => {
					  const totalMinutes = targetHours * 60;
					const levelDuration = levelMinutes;

					// pure time-based level count, no artificial cap
					const numLevels = Math.floor(totalMinutes / levelDuration);


					  // how fast blinds grow
					  const growthRate = speed === 'turbo' ? 1.9 : 1.7;

					  const levelsOut = [];
					  let bb = smallestChip * 2; // start at 2× smallest chip (e.g. 25→50 BB)

					  for (let i = 0; i < numLevels; i++) {
						// add a 10‑min break every 5th level (optional)
						if (i > 0 && i % 5 === 0) {
						  levelsOut.push({
							id: crypto.randomUUID(),
							sb: 0,
							bb: 0,
							ante: 0,
							duration: 10,
							isBreak: true,
							name: `Break ${i / 5}`,
						  });
						}

									// choose a base small blind from current bb estimate
					let sb = Math.max(
					  smallestChip,
					  Math.round((bb / 2) / smallestChip) * smallestChip
					);

					// force BB to be exactly double
					let bbClean = sb * 2;

					// minimum blinds
					if (bbClean < smallestChip * 2) {
					  sb = smallestChip;
					  bbClean = smallestChip * 2;
					}

					// If blinds are getting big, snap to 100-multiples
					if (bbClean > 200) {
					  sb = Math.round(sb / 100) * 100;
					  bbClean = sb * 2;
					}

					// Cap BB at 40 × highest chip denomination
					const maxBB = highestChip * 40;
					let bbFinal = bbClean;
					if (bbFinal > maxBB) {
					  bbFinal = maxBB;
					  // keep SB exactly half of BB when capped
					  sb = bbFinal / 2;
					}

					// If SB or BB are over 1000, round to nearest 500
					if (sb > 1000) {
					  sb = Math.round(sb / 500) * 500;
					  bbFinal = sb * 2;
					}
					if (bbFinal > 1000) {
					  bbFinal = Math.round(bbFinal / 500) * 500;
					  sb = bbFinal / 2;
					}

					// antes start halfway through, ~10% of BB
					let ante = 0;
					if (useAntes && i >= Math.floor(numLevels / 2)) {
					  ante = Math.round((bbFinal * 0.1) / smallestChip) * smallestChip;
					}

					// ---- DUPLICATE / NON‑DECREASING PROTECTION ----

					// Get last non-break blind level
					const lastBlind = [...levelsOut].reverse().find(l => !l.isBreak);

					if (lastBlind) {
					  // If antes are OFF, avoid exact duplicate SB/BB
					  if (!useAntes && lastBlind.sb === sb && lastBlind.bb === bbFinal) {
						sb = Math.round((sb * growthRate) / smallestChip) * smallestChip;
						bbFinal = sb * 2;

						// re-apply rounding/cap rules
						if (bbFinal > 200) {
						  sb = Math.round(sb / 100) * 100;
						  bbFinal = sb * 2;
						}
						if (bbFinal > maxBB) {
						  bbFinal = maxBB;
						  sb = bbFinal / 2;
						}
						if (sb > 1000) {
						  sb = Math.round(sb / 500) * 500;
						  bbFinal = sb * 2;
						}
						if (bbFinal > 1000) {
						  bbFinal = Math.round(bbFinal / 500) * 500;
						  sb = bbFinal / 2;
						}
					  }

					  // Ensure blinds never go down
					  if (sb <= lastBlind.sb || bbFinal <= lastBlind.bb) {
						sb = Math.round((lastBlind.sb * growthRate) / smallestChip) * smallestChip;
						bbFinal = sb * 2;

						// re-apply rounding/cap rules
						if (bbFinal > 200) {
						  sb = Math.round(sb / 100) * 100;
						  bbFinal = sb * 2;
						}
						if (bbFinal > maxBB) {
						  bbFinal = maxBB;
						  sb = bbFinal / 2;
						}
						if (sb > 1000) {
						  sb = Math.round(sb / 500) * 500;
						  bbFinal = sb * 2;
						}
						if (bbFinal > 1000) {
						  bbFinal = Math.round(bbFinal / 500) * 500;
						  sb = bbFinal / 2;
						}
					  }

					  // If this level would still be identical AND BB is at the cap,
					  // extend the last level instead of adding a duplicate
					  if (bbFinal === lastBlind.bb && sb === lastBlind.sb && bbFinal === maxBB) {
						lastBlind.duration += levelDuration; // extend last level
						continue; // skip pushing a new one
					  }
					}

					// Finally push the level
					levelsOut.push({
					  id: crypto.randomUUID(),
					  sb,
					  bb: bbFinal,
					  ante,
					  duration: levelDuration,
					  isBreak: false,
					});

					// increase for next level
					bb = bb * growthRate;

					  }

					  return levelsOut;
					};



			// ONE-CLICK TOURNAMENT BUILDER FUNCTIONS
			// SMART TOURNAMENT BUILDER FUNCTION
					const generateTournament = () => {
					  setLevels([]);
					  if (!highestChip || !targetHours || !levelMinutes) {
						alert('Please set Highest Chip, Hours, and Level Minutes first');
						return;
					  }
					  const newLevels = buildBlindLevels('regular');
					  setLevels(newLevels);
					  setCurrentLevelIndex(0);
					  setTimeRemaining(newLevels[0]?.duration * 60 || 900);
					  // Suggest starting stack based on Level 1 blinds and target length
							if (newLevels.length > 0) {
							  const firstLevel = newLevels.find(l => !l.isBreak) || newLevels[0];
							  if (firstLevel && firstLevel.bb > 0) {
								// Aim for ~75 BB at Level 1, scaled by targetHours
							const baseBB = firstLevel.bb;
							// make hours have a stronger effect:
							const targetBBs = 60 + targetHours * 20; // e.g. 60 BB at 1h, 120 BB at 4h

							let stack = baseBB * targetBBs;

							// use a smaller rounding unit (half-chip) to keep more granularity:
							const unit = highestChip || 500;
							const roundingUnit = unit / 2;
							stack = Math.round(stack / roundingUnit) * roundingUnit;

							//// ELIMINATES HOURS FROM EQUATION
							//// loosen the clamps:
							////if (stack < unit * 5) stack = unit * 5;
							////if (stack > unit * 200) stack = unit * 200;


								setSuggestedStack(stack);
							  } else {
								setSuggestedStack(null);
							  }
							}
					  alert(`Tournament Generated!\nHours: ${targetHours}\nLevels: ${newLevels.filter(l => !l.isBreak).length}`);
					};


            return (
                <div className={`${mainCardBgClass} p-5 rounded-2xl shadow-2xl w-full max-w-md md:max-w-4xl lg:max-w-6xl flex flex-col transition-colors duration-500 relative`}>
                    {/* Back to Home Button */}
                    <button
                        onClick={onBackToHome}
                        className="absolute top-4 left-4 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200 z-10"
                    >
                        &larr; Home
                    </button>

                    {showLogo && (
                        <img
                            src={logoToDisplay}
                            alt="Custom Logo"
                            // Pass both left and right offset states to handle positioning dynamically
                            style={{ maxHeight: `${logoHeightVh}vh`, ...getLogoStyle(logoTopOffset, undefined, logoRightOffset) }}
                            className="w-auto object-contain"
                            onError={(e) => {
                                e.target.onerror = null;
                                e.target.src = 'https://placehold.co/192x96/cccccc/333333?text=Logo+Error';
                                e.target.alt = "Logo could not be loaded";
                                e.target.style.maxHeight = `${logoHeightVh}vh`;
                                // Apply the saved top and right offsets if logo is on the right
                                Object.assign(e.target.style, getLogoStyle(logoTopOffset, undefined, logoRightOffset));
                            }}
                        />
                    )}

                    <div className="w-full flex flex-col items-center justify-center mb-3"> {/* Reduced mb-4 to mb-3 */}
                        <h1 className={`text-4xl font-bold text-center mb-3 font-outfit ${headingTextColorClass}`}>{tournamentTitle}</h1> {/* Replaced static title with state variable */}

                        <div className="flex flex-col md:flex-row items-start md:justify-center w-full gap-x-8 mb-3"> {/* Reduced mb-4 to mb-3 */}
                            {/* Tournament Clock Section */}
                            <div className="flex flex-col items-center w-full md:w-1/2 mb-3 md:mb-0"> {/* Reduced mb-4 to mb-3 */}
                                <div className="text-center mb-4 w-full"> {/* Reduced mb-6 to mb-4 */}
                                    {currentLevel ? (
                                        <div className={`text-6xl md:text-7xl lg:text-8xl font-sans tracking-wide ${sectionBgClass} px-4 py-1 rounded-xl shadow-inner inline-block transition-colors duration-500`}> {/* Reduced px-6 py-2 to px-4 py-1. Font size adjustment: lg:text-8xl retained, but md and default reduced*/}
                                            {formatTime(timeRemaining)}
                                        </div>
                                    ) : (
                                        <p className={`text-5xl md:text-6xl font-sans ${placeholderColorClass}`}>Tournament Over!</p>
                                    )}
                                </div>

                                {currentLevel && (
                                    <div className={`mb-4 p-2 rounded-lg w-full max-w-md md:max-w-xl mx-auto ${sectionBgClass} transition-colors duration-500`}>
                                        {/* Reduced mb-6 to mb-4 and p-3 to p-2 */}
                                        {currentLevel.isBreak ? (
                                            /* Reduced text-4xl to text-3xl */
                                            <h2 className={`text-3xl font-bold text-center ${headingTextColorClass} font-outfit`}>{currentLevel.name}</h2>
                                        ) : (
                                            <>
                                                {/* Reduced text-5xl to text-4xl and md:text-6xl to md:text-5xl */}
                                                <p className="text-4xl md:text-5xl font-bold text-center font-outfit text-yellow-400">
												  Blinds: {formatBlind(currentLevel.sb)}/{formatBlind(currentLevel.bb)}
												</p>
												{currentLevel.ante > 0 && (
												  <p className="text-3xl md:text-4xl font-bold text-center font-outfit text-yellow-400 mt-1">
													Ante: {currentLevel.ante}
												  </p>
												)}


                                                {/* Reduced text-3xl to text-2xl and md:text-4xl to md:text-3xl */}
                                                <p className={`text-2xl md:text-3xl text-center ${subtextColorClass}`}>
                                                    Level {currentLevelIndex + 1}
                                                </p>
                                            </>
                                        )}
                                    </div>
                                )}

                                {/* Next Level Information */}
                                {nextLevelData && (
                                    <div className={`mb-3 p-2 rounded-lg w-full max-w-md mx-auto ${inputBgClass} border ${inputBorderClass} transition-colors duration-500`}>
                                        {/* Reduced mb-4 to mb-3 and p-3 to p-2 */}
                                        {/* Reduced text-xl to text-lg */}
                                        <h3 className={`text-xl font-bold text-center ${headingTextColorClass}`}>Next Level:</h3>
                                        {nextLevelData.isBreak ? (
                                            /* Reduced text-xl to text-base */
                                            <p className={`text-2xl text-center ${subtextColorClass}`}>{nextLevelData.name} ({nextLevelData.duration} min)</p>
                                        ) : (
                                            /* Removed $ from blinds as per user request */
                                            <p className={`text-2xl text-center ${subtextColorClass}`}>
                                                Blinds: {nextLevelData.sb}/{nextLevelData.bb} {nextLevelData.ante > 0 ? `(Ante: ${currentLevel.ante})` : ''} ({nextLevelData.duration} min)
                                            </p>
                                        )}
                                    </div>
                                )}

                                {/* Rebuy Timer and Tournament End Timer Information */}
                                <div className={`mb-4 p-2 rounded-lg w-full max-w-md mx-auto ${inputBgClass} border ${inputBorderClass} transition-colors duration-500`}>
                                    {rebuyEndsAfterLevelIndex !== -1 && rebuyTimeRemaining > 0 && currentLevelIndex <= rebuyEndsAfterLevelIndex ? (
                                        <p className={`text-base text-center font-semibold ${subtextColorClass}`}>
                                            Rebuy Period Ends In: {" "}
											<span className="font-semibold">
											  {formatHoursMinutes(rebuyTimeRemaining)}
											</span>
                                        </p>
                                    ) : rebuyEndsAfterLevelIndex !== -1 && rebuyTimeRemaining === 0 && currentLevelIndex <= rebuyEndsAfterLevelIndex ? (
                                        <p className={`text-base text-center font-semibold text-red-500`}>
                                            Rebuy Period Ending Soon!
                                        </p>
                                    ) : rebuyEndsAfterLevelIndex !== -1 && currentLevelIndex > rebuyEndsAfterLevelIndex ? (
                                        <p className={`text-base text-center font-semibold ${placeholderColorClass}`}>
                                            Rebuy Period Ended
                                        </p>
                                    ) : (
                                        <p className={`text-base text-center font-semibold ${placeholderColorClass}`}>
                                            No Rebuy Period Set
                                        </p>
                                    )}

                                    {showTournamentEndTime && (
                                        <div className="mt-2 pt-2 border-t border-gray-500">
                                            {tournamentEndTimeDisplayMode === 'localTime' && tournamentEndTime ? (
                                                <p className={`text-base text-center font-semibold ${subtextColorClass}`}>
                                                    Tournament Ends At: {tournamentEndTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                                </p>
                                            ) : (
                                                <p className={`text-base text-center font-semibold ${subtextColorClass}`}>
                                                    Total Time Left: {" "}
													<span className="font-semibold">
													  {formatHoursMinutes(remainingTournamentDuration)}
													</span>
                                                </p>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Prize Pool & Buy-in/Rebuy/Add-on Display on Main Page */}
                            <div className={`p-3 rounded-lg w-full md:w-1/2 md:max-w-md mx-auto ${sectionBgClass} transition-colors duration-500 md:mt-auto`}>
                                <h3 className={`text-lg font-bold text-center mb-3 ${headingTextColorClass}`}>
                                    Total Prize Pool: <span className="font-semibold">${totalPrizePool.toLocaleString()}</span>
                                </h3>
                                {/* Buttons for Buy-in, Rebuy, Add-on */}
                                <div className="flex flex-col sm:flex-row justify-center gap-2 w-full mt-3">
                                    {/* Container for Buy-in button and its count */}
                                    <div className="flex-1 flex flex-col items-center">
                                        <button onClick={handleLateRegistrationBuyIn} disabled={buyInAmount === 0} className="w-full px-5 py-2.5 h-12 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-center whitespace-nowrap">
                                            Buy-in (${buyInAmount})
                                        </button>
                                        <p className={`${subtextColorClass} text-xs mt-0.5`}>Total Buy-ins: {numPlayers}</p>
                                    </div>
                                    {/* Container for Rebuy button and its count */}
                                    <div className="flex-1 flex flex-col items-center">
                                        <button onClick={handleRebuy} disabled={rebuyAmount === 0} className="w-full px-5 py-2.5 h-12 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-center whitespace-nowrap">
                                            Rebuy (${rebuyAmount})
                                        </button>
                                        <p className={`${subtextColorClass} text-xs mt-0.5`}>Total Rebuys: {rebuyCount}</p>
                                    </div>
                                    {/* Container for Add-On button and its count */}
                                    <div className="flex-1 flex flex-col items-center">
                                        <button onClick={handleAddOn} disabled={addOnAmount === 0} className="w-full px-5 py-2.5 h-12 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center text-center whitespace-nowrap">
                                            Add-On (${addOnAmount})
                                        </button>
                                        <p className={`${subtextColorClass} text-xs mt-0.5`}>Total Add-ons: {addOnCount}</p>
                                    </div>
                                </div>

                                {/* Display Payout Structure on main screen */}
                                {payoutStructure.length > 0 && (
                                    <div className="mt-4 border-t border-gray-500 pt-4 flex flex-col items-center w-full">
                                        <div className="flex flex-col space-y-1 w-full max-w-xs">
                                            {payoutStructure.sort((a, b) => a.place - b.place).map((payout) => (
                                                <div key={payout.id} className="flex items-center text-xl justify-center">
                                                    <span className={`${subtextColorClass} font-semibold w-28 text-right`}> {/* Increased width to w-28, kept text-right */}
                                                        {payout.place}{payout.place === 1 ? 'st' : payout.place === 2 ? 'nd' : payout.place === 3 ? 'rd' : 'th'} Place:
                                                    </span>
                                                    <span className={`font-semibold ${subtextColorClass} w-28 text-left ml-4`}> {/* Increased width to w-28, added ml-4 */}
                                                        ${Math.round((payout.percentage / 100) * totalPrizePool).toLocaleString()}
                                                    </span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Timer and Level Navigation Buttons */}
                        <div className="flex flex-wrap justify-center gap-2 w-full mt-4">
                            <button onClick={startTimer} disabled={isRunning || levels.length === 0} className="flex-1 min-w-[100px] px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base">Start</button>
                            <button onClick={pauseTimer} disabled={!isRunning} className="flex-1 min-w-[100px] px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base">Pause</button>
                            <button onClick={resetTournament} disabled={timeRemaining === (levels[currentLevelIndex]?.duration * 60 || 0) && !isRunning} className="flex-1 min-w-[100px] px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base">Reset</button>
                            <button onClick={prevLevel} disabled={currentLevelIndex === 0} className="flex-1 min-w-[100px] px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base">Prev Level</button>
                            <button onClick={nextLevel} disabled={currentLevelIndex >= levels.length - 1} className="flex-1 min-w-[100px] px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base">Next Level</button>
                        </div>
                    </div>

                    {/* Chip Denominations Display and Settings/Fullscreen Buttons */}
                    <div className="flex flex-col sm:flex-row justify-between items-center w-full mt-4">
                        {showChipDisplay && (
                            <div className={`p-3 rounded-lg ${sectionBgClass} flex flex-wrap justify-center sm:justify-start items-center gap-4 transition-colors duration-500 flex-grow`}>
                                <h3 className={`text-xl font-bold ${headingTextColorClass} mr-4`}>Chip Values:</h3>
                                {chipDenominations.sort((a, b) => a.value - b.value).map(chip => (
                                    <div key={chip.id} className="flex flex-col items-center">
                                        {/* Increased font size for chip symbol and value */}
                                        <span className={`text-5xl font-bold`} style={{ color: chip.color }}>◎</span>
                                        <span className={`${subtextColorClass} text-base`}>{chip.value.toLocaleString()}</span>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Settings and Fullscreen buttons */}
                        <div className="flex justify-end space-x-4 flex-shrink-0 mt-4 sm:mt-0">
                            <button onClick={() => setShowSettings(true)} className={`${sectionBgClass} p-3 rounded-full shadow-md transition-all duration-200 hover:scale-105`}>
                                <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${subtextColorClass}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.39a2 2 0 00.73 2.73l.08.15a2 2 0 010 2l-.15.25a2 2 0 00-.73 2.73l.22.39a2 2 0 012.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 001 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l-.22-.39a2 2 0 00-.73-2.73l-.08-.15a2 2 0 010-2l.15-.25a2 2 0 00.73-2.73l-.22-.39a2 2 0 01-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25A2 2 0 0013 4.18V2a2 2 0 00-2-2z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </button>
                            <button onClick={toggleFullscreen} className={`${sectionBgClass} p-3 rounded-full shadow-md transition-all duration-200 hover:scale-105`}>
                                {isFullscreen ? (
                                    <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${subtextColorClass}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 3h6v6" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 21H3v-6" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3l7.5 7.5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-7.5-7.5" />
                                    </svg>
                                ) : (
                                    <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${subtextColorClass}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 2H2v5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M22 7V2h-5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 22h5v-5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2 17v5h5" />
                                    </svg>
                                )}
                            </button>
                        </div>
                    </div>

                    {showSettings && (
                        <div className={`fixed inset-0 ${theme === 'dark' ? 'bg-gray-900 bg-opacity-75' : 'bg-gray-200 bg-opacity-75'} flex items-center justify-center z-50 transition-colors duration-500`}>
                            <div className={`${mainCardBgClass} p-6 rounded-2xl shadow-2xl w-full ${tournamentSettingsSubView === 'chipSettings' ? 'max-w-3xl' : 'max-w-4xl'} overflow-y-auto max-h-[90vh] transition-colors duration-500`}>
                                <h2 className={`text-3xl font-bold text-center mb-6 ${headingTextColorClass}`}>
                                    {tournamentSettingsSubView === 'menu' ? 'Tournament Settings' :
                                    tournamentSettingsSubView === 'blinds' ? 'Level Structure' :
                                    tournamentSettingsSubView === 'payouts' ? 'Edit Payout Structure' :
                                    tournamentSettingsSubView === 'logo' ? 'Logo Settings' :
                                    tournamentSettingsSubView === 'chipSettings' ? 'Chip and Stack Configuration' :
                                    'Theme Settings'}
                                </h2>

                                {/* Main Tournament Settings Menu */}
                                {tournamentSettingsSubView === 'menu' && (
                                    <div className="flex flex-col space-y-4">
                                        <div className="flex flex-col mb-4">
										  <label
											htmlFor="tournament-title"
											className="text-sm font-semibold text-yellow-300 mb-1"
										  >
											Tournament Title (click to edit)
										  </label>
										  <input
											id="tournament-title"
											type="text"
											value={tournamentTitle}
											onChange={(e) => setTournamentTitle(e.target.value)}
											placeholder="Type your tournament name here"
											className={`px-4 py-2 rounded-md border-2 border-yellow-400 bg-white text-gray-900 text-base font-semibold shadow-sm focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/60 focus:outline-none`}
										  />
										  <p className="mt-1 text-xs text-gray-300">
											This title appears on the main tournament clock.
										  </p>
										</div>

                                        <button
                                            onClick={() => setTournamentSettingsSubView('blinds')}
                                            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                        >
                                            Level Structure Settings
                                        </button>
                                        <button
                                            onClick={() => setTournamentSettingsSubView('payouts')}
                                            className="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                        >
                                            Payout Settings
                                        </button>
                                        <button
                                            onClick={() => setTournamentSettingsSubView('chipSettings')}
                                            className="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                        >
                                            Chip and Stack Settings
                                        </button>
                                        <button
                                            onClick={() => setTournamentSettingsSubView('logo')}
                                            className="px-6 py-3 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                        >
                                            Logo Settings
                                        </button>
										<button
                                            onClick={() => setTournamentSettingsSubView('theme')}
                                            className="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                        >
                                            Theme Settings
                                        </button>
                                        <div className="flex justify-end mt-8">
                                            <button onClick={() => setShowSettings(false)} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Blind Structure Settings View */}
                                {tournamentSettingsSubView === 'blinds' && (
                                    <>
                                        
										<div className="mb-6 flex flex-col items-center space-y-4">
										{/* Blind Presets Bar */}
												<div className="mb-4 p-3 rounded-lg bg-gray-800 text-gray-100">
												  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
													{/* Left: dropdown + delete */}
													<div className="flex-1 flex flex-col gap-2">
													  <p className="font-semibold text-sm md:text-base">Tournament Presets</p>

													  {blindPresets.length === 0 ? (
														<p className="text-xs text-gray-400">
														  No presets yet. Save your current structure to reuse it later.
														</p>
													  ) : (
														<div className="flex flex-col sm:flex-row gap-2 items-start sm:items-center">
														  <select
															className="px-3 py-1.5 rounded-md bg-gray-700 border border-gray-600 text-sm text-gray-100 focus:border-yellow-400 focus:outline-none min-w-[180px]"
															value={activePresetId || ''}
															onChange={(e) => {
															  const id = e.target.value || null;
															  if (id) {
																handleLoadPreset(id);
															  } else {
																setActivePresetId(null);
															  }
															}}
														  >
															<option value="">Select preset…</option>
															{blindPresets.map((preset) => (
															  <option key={preset.id} value={preset.id}>
																{preset.name}
															  </option>
															))}
														  </select>

														  <button
															type="button"
															disabled={!activePresetId}
															onClick={() => activePresetId && handleDeletePreset(activePresetId)}
															className={
															  "px-3 py-1.5 text-sm font-semibold rounded-md border " +
															  (activePresetId
																? "bg-red-600 hover:bg-red-500 text-white border-red-500"
																: "bg-gray-600 text-gray-300 border-gray-500 cursor-not-allowed")
															}
														  >
															Delete
														  </button>
														</div>
													  )}
													</div>

													{/* Right: save new preset */}
													<div className="flex items-center gap-2 md:w-80">
													  <input
														type="text"
														placeholder="Preset name (e.g. Deep 4h)"
														value={newPresetName}
														onChange={(e) => setNewPresetName(e.target.value)}
														className="flex-1 px-3 py-1.5 rounded-md bg-gray-700 border border-gray-600 text-sm text-gray-100 focus:border-yellow-400 focus:outline-none"
													  />
													  <button
														type="button"
														onClick={handleSavePreset}
														className="px-3 py-1.5 bg-green-600 hover:bg-green-500 text-white text-sm font-semibold rounded-md"
													  >
														Save
													  </button>
													</div>
												  </div>
												</div>

											{/* New Toggle for Tournament End Time/Duration */}
											<div
  className={`flex flex-wrap items-center justify-start gap-x-6 gap-y-2 w-full px-4 py-2 rounded-lg ${sectionBgClass}`}
>
  {/* Toggle + label */}
  <div className="flex items-center space-x-3">
    <span className={`${subtextColorClass} text-base whitespace-nowrap`}>
      Show Tournament End Time:
    </span>
    <label htmlFor="toggle-tournament-end-time" className="flex items-center cursor-pointer">
      <div className="relative">
        <input
          type="checkbox"
          id="toggle-tournament-end-time"
          className="sr-only"
          checked={showTournamentEndTime}
          onChange={(e) => setShowTournamentEndTime(e.target.checked)}
        />
        <div
  className={`block w-14 h-8 rounded-full border border-gray-300 transition-colors duration-300 ${
    showTournamentEndTime ? 'bg-green-500' : 'bg-gray-700'
  }`}
/>
<div
  className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full shadow-md transition-transform duration-300 transform"
  style={{ transform: showTournamentEndTime ? 'translateX(24px)' : 'translateX(0)' }}
></div>

      </div>
    </label>
  </div>

  {/* Display mode radios */}
  {showTournamentEndTime && (
    <div className="flex items-center space-x-3">
      <span className={`${subtextColorClass} text-sm whitespace-nowrap`}>Display As:</span>
      <label className="inline-flex items-center">
        <input
          type="radio"
          className={`form-radio ${theme === 'dark' ? 'text-blue-500' : 'text-blue-600'}`}
          name="endTimeDisplayMode"
          value="localTime"
          checked={tournamentEndTimeDisplayMode === 'localTime'}
          onChange={(e) => setTournamentEndTimeDisplayMode(e.target.value)}
        />
        <span className={`ml-1 ${subtextColorClass}`}>Local Time</span>
      </label>
      <label className="inline-flex items-center">
        <input
          type="radio"
          className={`form-radio ${theme === 'dark' ? 'text-blue-500' : 'text-blue-600'}`}
          name="endTimeDisplayMode"
          value="timeLeft"
          checked={tournamentEndTimeDisplayMode === 'timeLeft'}
          onChange={(e) => setTournamentEndTimeDisplayMode(e.target.value)}
        />
        <span className={`ml-1 ${subtextColorClass}`}>Time Left</span>
      </label>
    </div>
  )}
</div>


											<div className="flex items-center space-x-4 justify-center w-full">
											  <label
												htmlFor="rebuy-ends-after-level"
												className={`${subtextColorClass} text-base whitespace-nowrap`}
											  >
												Rebuy Ends After Level:
											  </label>
											  <select
												id="rebuy-ends-after-level"
												value={rebuyEndsAfterLevelIndex}
												onChange={(e) => setRebuyEndsAfterLevelIndex(parseInt(e.target.value))}
												className={`px-3 py-2 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass} focus:border-blue-500 focus:outline-none`}
											  >
												<option value={-1}>No Rebuy Period</option>
												{levels.map((level, index) => (
												  <option key={level.id} value={index}>
													Level {index + 1}{' '}
													{level.isBreak
													  ? `(${level.name})`
													  : `(Blinds: ${formatBlind(level.sb)}/${formatBlind(level.bb)})`}
												  </option>
												))}
											  </select>
											</div>
										</div>
                                        <div className="space-y-4 mb-8">
										
                                            {levels.map((level, index) => (
                                                <div key={level.id} className={`${sectionBgClass} p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-center md:justify-between gap-4`}>
                                                    {/* Display Level Name/Number */}
                                                    <p className={`font-semibold text-lg ${headingTextColorClass} flex-shrink-0 md:w-32`}>
                                                        {level.isBreak ? level.name : `Level ${index + 1}`}
                                                    </p>

                                                    {level.isBreak ? (
                                                        <div className="flex items-center gap-2 flex-grow justify-start md:justify-center">
                                                            <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Duration (min):</label>
                                                            <NumberSpinner
                                                                value={level.duration}
                                                                min={1} max={60} step={1}
                                                                onChange={(val) => updateLevel(level.id, 'duration', val)}
                                                                theme={theme}
                                                                widthClass="w-20"
                                                                textSizeClass="text-base"
                                                            />
                                                        </div>
                                                    ) : (
                                                        <div className="flex flex-wrap items-center gap-x-4 gap-y-2 flex-grow justify-start"> {/* Use flex-wrap for inputs */}
                                                            <div className="flex items-center gap-2">
                                                                <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>SB:</label>
                                                                <input
                                                                    type="number"
                                                                    value={level.sb}
                                                                    onChange={(e) => updateLevel(level.id, 'sb', parseInt(e.target.value) || 0)}
                                                                    min="0"
                                                                    className={`w-20 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                                />
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>BB:</label>
                                                                <input
                                                                    type="number"
                                                                    value={level.bb}
                                                                    onChange={(e) => updateLevel(level.id, 'bb', parseInt(e.target.value) || 0)}
                                                                    min="0"
                                                                    className={`w-20 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                                />
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Ante:</label>
                                                                <input
                                                                    type="number"
                                                                    value={level.ante}
                                                                    onChange={(e) => updateLevel(level.id, 'ante', parseInt(e.target.value) || 0)}
                                                                    min="0"
                                                                    className={`w-20 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                                />
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Duration (min):</label>
                                                                <NumberSpinner
                                                                    value={level.duration}
                                                                    min={1} max={60} step={1}
                                                                    onChange={(val) => updateLevel(level.id, 'duration', val)}
                                                                    theme={theme}
                                                                    widthClass="w-20"
                                                                    textSizeClass="text-base"
                                                            />
                                                            </div>
                                                        </div>
                                                    )}
                                                    <button
                                                        onClick={() => deleteLevel(level.id)}
                                                        className="px-3 py-1 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 self-end md:self-center flex-shrink-0"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="flex justify-center space-x-4 mb-8">
                                            <button
                                                onClick={addLevel}
                                                className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                            >
                                                Add New Level
                                            </button>
                                            <button
											  onClick={() => setPendingBreakAfterIndex(0)}
											  className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
											>
											  Add Break
											</button>
											<button onClick={() => confirm('Clear ALL levels?') && (setLevels([]), setCurrentLevelIndex(0), setTimeRemaining(0))} className="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
											>
											Clear All Levels
											</button>
                                        </div>
{pendingBreakAfterIndex !== null && levels.length > 0 && (
  <div className="mt-4 flex flex-col md:flex-row items-center gap-3">
    <span className={`${subtextColorClass} text-sm`}>
      Insert break after:
    </span>
    <select
      value={pendingBreakAfterIndex}
      onChange={(e) => setPendingBreakAfterIndex(parseInt(e.target.value, 10))}
      className={`px-3 py-2 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass} focus:border-blue-500 focus:outline-none`}
    >
      {levels.map((level, index) => (
        !level.isBreak && (
          <option key={level.id} value={index}>
            Level {index + 1} (Blinds: {formatBlind(level.sb)}/{formatBlind(level.bb)})
          </option>
        )
      ))}
    </select>

    <button
      onClick={() => {
        if (pendingBreakAfterIndex == null) return;
        setLevels(prev => {
          const insertIndex = pendingBreakAfterIndex + 1;
          const breakNumber = prev.filter(l => l.isBreak).length + 1;
          const newBreak = {
            id: crypto.randomUUID(),
            isBreak: true,
            duration: 10,
            name: `Break ${breakNumber}`,
          };
          const copy = [...prev];
          copy.splice(insertIndex, 0, newBreak);
          return copy;
        });
        setPendingBreakAfterIndex(null);
      }}
      className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold rounded-lg shadow-md transition-all duration-200"
    >
      Insert Break
    </button>

    <button
      onClick={() => setPendingBreakAfterIndex(null)}
      className="px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white text-xs font-semibold rounded-lg shadow-md transition-all duration-200"
    >
      Cancel
    </button>
  </div>
)}

                                        <div className="flex flex-col md:flex-row justify-between items-center mt-8 gap-4">
											  <button
												onClick={() => setTournamentSettingsSubView('menu')}
												className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
											  >
												Back to Main Settings
											  </button>

											  <button
												onClick={() => setShowSmartBuilder(prev => !prev)}
												className="px-6 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-red-500 
												   hover:from-indigo-400 hover:via-purple-400 hover:to-red-400
												   text-white font-semibold rounded-lg shadow-md transition-all duration-200 hover:scale-105"

											  >
												{showSmartBuilder ? 'Hide Smart Builder' : 'Smart Tournament Builder'}
											  </button>

											  <button
												onClick={() => {
												  handleSaveLevels(levels);
												  setTournamentSettingsSubView('menu');
												}}
												className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
											  >
												Save Blinds
											  </button>
											</div>

							{/* ONE-CLICK TOURNAMENT BUILDER – SMALL ROOM EDITION */}
							{/* IMPROVED TOURNAMENT BUILDER */}
									{showSmartBuilder && (
									<div className="mt-10 p-6 bg-gradient-to-br from-indigo-900 via-purple-900 to-red-900 rounded-2xl border-4 border-yellow-400 shadow-2xl">
									<div className="mt-10 p-6 bg-gradient-to-br from-indigo-900 via-purple-900 to-red-900 rounded-2xl border-4 border-yellow-400 shadow-2xl">
										  <h3 className="text-3xl font-bold text-center mb-6 text-yellow-300">Smart Tournament Builder</h3>
										  
										  <div className="space-y-6">
											{/* Tournament Parameters */}
											<div className="bg-gray-800 bg-opacity-50 rounded-xl p-5 space-y-4">
											  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
												<label className="text-gray-200 font-semibold text-base md:text-lg whitespace-nowrap">Smallest Chip Value:</label>
												<input
												  type="number"
												  value={smallestChip || 25}
												  onChange={(e) => setSmallestChip(Math.max(1, parseInt(e.target.value) || 25))}
												  className="w-32 px-3 py-2 rounded-lg bg-gray-700 border-2 border-gray-600 text-white text-center font-bold text-lg focus:border-yellow-400 focus:outline-none"
												/>
											  </div>

											  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
												<label className="text-gray-200 font-semibold text-base md:text-lg whitespace-nowrap">Highest Chip Value:</label>
												<input
												  type="number"
												  value={highestChip}
												  onChange={(e) => setHighestChip(Math.max(1, parseInt(e.target.value) || 1000))}
												  className="w-32 px-3 py-2 rounded-lg bg-gray-700 border-2 border-gray-600 text-white text-center font-bold text-lg focus:border-yellow-400 focus:outline-none"
												/>
											  </div>

											  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
												<label className="text-gray-200 font-semibold text-base md:text-lg whitespace-nowrap">Tournament Length (hours):</label>
												<input
												  type="number"
												  step="0.5"
												  value={targetHours}
												  onChange={(e) => setTargetHours(Math.max(1, parseFloat(e.target.value) || 1))}
												  className="w-32 px-3 py-2 rounded-lg bg-gray-700 border-2 border-gray-600 text-white text-center font-bold text-lg focus:border-yellow-400 focus:outline-none"
												/>
											  </div>

											  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
												<label className="text-gray-200 font-semibold text-base md:text-lg whitespace-nowrap">Minutes per Level:</label>
												<input
												  type="number"
												  value={levelMinutes}
												  onChange={(e) => setLevelMinutes(Math.max(3, parseInt(e.target.value) || 3))}
												  className="w-32 px-3 py-2 rounded-lg bg-gray-700 border-2 border-gray-600 text-white text-center font-bold text-lg focus:border-yellow-400 focus:outline-none"
												/>
											  </div>
											  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
										  <label className="text-gray-200 font-semibold text-base md:text-lg whitespace-nowrap">
											Use Antes:
										  </label>
										  <label className="flex items-center cursor-pointer">
											<div className="relative">
											  <input
												type="checkbox"
												className="sr-only"
												checked={useAntes}
												onChange={(e) => setUseAntes(e.target.checked)}
											  />
											  <div className="block bg-gray-600 w-14 h-8 rounded-full"></div>
											  <div
												className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
												style={{ transform: useAntes ? 'translateX(24px)' : 'translateX(0)' }}
											  ></div>
											</div>
											<span className="ml-3 text-gray-200 font-semibold">
											  {useAntes ? 'On' : 'Off'}
											</span>
										  </label>
										</div>

											</div>

											{/* Generate Button */}
											<div className="text-center">
											  
											  <button onClick={generateTournament} className="px-8 py-4 bg-green-600 hover:bg-green-500 rounded-xl font-bold text-xl text-white shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105">
												Generate Tournament
											  </button>
											</div>
										  </div>
										</div>
	</div>
	)}
	
									</>
                                )}

                                {/* Payout Structure Settings View */}
                                {tournamentSettingsSubView === 'payouts' && (
                                    <>
                                        {/* New wrapper div for centering and consistent width */}
                                        <div className="max-w-sm mx-auto space-y-4 mb-4">
                                            <div className="flex items-center space-x-4">
                                                <label htmlFor="buy-in-amount" className={`${subtextColorClass} text-base whitespace-nowrap flex-shrink-0 w-40 text-right`}>Buy-in Amount ($):</label>
                                                <NumberSpinner
                                                    value={buyInAmount}
                                                    min={0} max={10000} step={5}
                                                    onChange={setBuyInAmount}
                                                    theme={theme}
                                                    widthClass="w-28"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            <div className="flex items-center space-x-4">
                                                <label htmlFor="rebuy-amount" className={`${subtextColorClass} text-base whitespace-nowrap flex-shrink-0 w-40 text-right`}>Rebuy Amount ($):</label>
                                                <NumberSpinner
                                                    value={rebuyAmount}
                                                    min={0} max={10000} step={5}
                                                    onChange={setRebuyAmount}
                                                    theme={theme}
                                                    widthClass="w-28"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            <div className="flex items-center space-x-4">
                                                <label htmlFor="add-on-amount" className={`${subtextColorClass} text-base whitespace-nowrap flex-shrink-0 w-40 text-right`}>Add-on Amount ($):</label>
                                                <NumberSpinner
                                                    value={addOnAmount}
                                                    min={0} max={10000} step={5}
                                                    onChange={setAddOnAmount}
                                                    theme={theme}
                                                    widthClass="w-28"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                        </div>

                                        <div className={`mb-6 p-4 rounded-lg text-center font-bold text-2xl shadow-inner ${sectionBgClass} ${headingTextColorClass}`}>
                                            Total Prize Pool: ${totalPrizePool.toLocaleString()}
                                        </div>

                                        {/* Adjusted layout for Total Rebuys and Total Add-ons */}
                                        <div className="max-w-sm mx-auto space-y-4 mb-8">
                                            {/* Moved Number of Players here */}
                                            <div className="flex items-center space-x-4">
                                                <label htmlFor="num-players" className={`${subtextColorClass} text-base whitespace-nowrap flex-shrink-0 w-40 text-right`}>Number of Players:</label>
                                                <NumberSpinner
                                                    value={numPlayers}
                                                    min={0} max={500} step={1}
                                                    onChange={setNumPlayers}
                                                    theme={theme}
                                                    widthClass="w-28"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            <div className="flex items-center space-x-4">
                                                <label className={`${subtextColorClass} text-base whitespace-nowrap flex-shrink-0 w-40 text-right`}>Total Rebuys:</label>
                                                <NumberSpinner
                                                    value={rebuyCount}
                                                    min={0} max={999} step={1}
                                                    onChange={setRebuyCount}
                                                    theme={theme}
                                                    widthClass="w-28"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            <div className="flex items-center space-x-4">
                                                <label className={`${subtextColorClass} text-base whitespace-nowrap flex-shrink-0 w-40 text-right`}>Total Add-ons:</label>
                                                <NumberSpinner
                                                    value={addOnCount}
                                                    min={0} max={999} step={1}
                                                    onChange={setAddOnCount}
                                                    theme={theme}
                                                    widthClass="w-28"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            {/* Removed Late Registrations input */}
                                        </div>

                                        <div className="space-y-4 mb-8">
                                            {payoutStructure.length === 0 && (
                                                <p className={`${placeholderColorClass} text-center`}>No payout places added yet.</p>
                                            )}
                                            {payoutStructure.sort((a, b) => a.place - b.place).map((payout) => (
                                                <div key={payout.id} className="flex items-center gap-4 justify-center">
                                                    <span className={`${subtextColorClass} font-semibold w-28 text-right`}>
                                                        {payout.place}{payout.place === 1 ? 'st' : payout.place === 2 ? 'nd' : payout.place === 3 ? 'rd' : 'th'} Place:
                                                    </span>
                                                    <input
                                                        type="number"
                                                        value={payout.percentage}
                                                        onChange={(e) => updatePayoutPlace(payout.id, 'percentage', parseInt(e.target.value) || 0)}
                                                        min="0"
                                                        max="100"
                                                        className={`w-20 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass} text-xl`}
                                                    />
                                                    <span className={`${subtextColorClass} text-xl font-semibold`}>%</span>
                                                    <span className={`font-semibold ${subtextColorClass} w-28 text-left ml-4`}>
                                                        ${Math.round((payout.percentage / 100) * totalPrizePool).toLocaleString()}
                                                    </span>
                                                    <button
                                                        onClick={() => deletePayoutPlace(payout.id)}
                                                        className="px-3 py-1 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="flex justify-center space-x-4 mb-8">
										  <button
											onClick={addPayoutPlace}
											className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
										  >
											Add Payout Place
										  </button>
										  <button
											onClick={clearPayouts}
											className="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
										  >
											Clear Payouts
										  </button>
										  <button
											onClick={clearPayoutCounts}
											className="px-6 py-3 bg-amber-600 hover:bg-amber-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
										  >
											Clear Counts
										  </button>
										</div>


                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setTournamentSettingsSubView('menu')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setTournamentSettingsSubView('menu');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Payouts
                                            </button>
                                        </div>
                                    </>
                                )}

                                
                                {/* Chip Denominations Settings View (for Tournament Mode) */}
                                {tournamentSettingsSubView === 'chipSettings' && (
                                    <>
									
                                        <div className="flex flex-col space-y-4 mb-6">
                                            <div className="flex items-center justify-between">
                                                <span className={`${subtextColorClass} text-base`}>Show Chip Display:</span>
                                                <label htmlFor="toggle-tournament-chip-display" className="flex items-center cursor-pointer">
                                                    <div className="relative">
                                                        <input
                                                            type="checkbox"
                                                            id="toggle-tournament-chip-display"
                                                            className="sr-only"
                                                            checked={showChipDisplay}
                                                            onChange={(e) => setShowChipDisplay(e.target.checked)}
                                                        />
                                                        <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
                                                        <div className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
                                                            style={{ transform: showChipDisplay ? 'translateX(24px)' : 'translateX(0)' }}></div>
                                                    </div>
                                                </label>
                                            </div>
<div className="mb-6">
      {/* Highlighted required-settings box */}
      <div className="mb-4 rounded-xl border border-yellow-400/70 bg-yellow-500/5 px-4 py-3 shadow-inner">
        <p className="text-sm font-semibold text-yellow-300 mb-2 tracking-wide">
          <span className="underline">
      Enter number of players and amount of each denomination owned.
    </span>
        </p>

        <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
     <p className="text-sm text-gray-200">
  Suggested Starting Stack: {idealStack?.toLocaleString() ?? '—'}
</p>

{chipDistribution && (
  <p
    className={
      totalValuePerPlayer === idealStack
        ? 'text-sm text-green-400'
        : 'text-sm text-yellow-300'
    }
  >
    Actual stack per player with available chips:{' '}
    {effectiveStack.toLocaleString()}
    {totalValuePerPlayer !== idealStack && ' (closest exact value)'}
  </p>
)}
     


          <div className="flex items-center gap-2">
            <label className="text-sm text-gray-200 whitespace-nowrap">
              <span className="text-yellow-300 font-semibold"></span> Number of Players:
            </label>
            <input
              type="number"
              min="1"
              value={chipPlayers}
              onChange={(e) =>
                setChipPlayers(Math.max(1, parseInt(e.target.value) || 1))
              }
              className={`w-20 px-2 py-1 rounded-md bg-gray-900/80 border border-yellow-400/70 text-yellow-200 font-semibold focus:outline-none focus:ring-2 focus:ring-yellow-400`}
            />
          </div>
        </div>
      </div>
    </div>


                                            <div className="space-y-4">
                                                {chipDenominations.sort((a, b) => a.value - b.value).map(chip => (
                                                    <div key={chip.id} className={`${sectionBgClass} p-3 rounded-lg shadow-sm flex items-center gap-4`}>
                                                        <span className={`text-3xl font-bold`} style={{ color: chip.color }}>◎</span>
                                                        <div className="flex items-center gap-2 flex-grow">
                                                            <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Color:</label>
                                                            {/* Replaced text input with select dropdown for colors */}
                                                            <select
                                                                value={chip.color}
                                                                onChange={(e) => updateChipDenomination(chip.id, 'color', e.target.value)}
                                                                className={`w-28 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                            >
                                                                {predefinedColors.map(color => (
                                                                    <option key={color.hex} value={color.hex} style={{ backgroundColor: color.hex, color: (color.name === 'Black' || color.name === 'Maroon' || color.name === 'Indigo') ? 'white' : 'black' }}>
                                                                        {color.name}
                                                                    </option>
                                                                ))}
                                                            </select>
                                                        </div>
														

                                                        {/* Value column – now closer to Color */}
  <div className="flex items-center gap-2 w-32">
    <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Value:</label>
    <input
      type="number"
      value={chip.value}
      onChange={(e) => updateChipDenomination(chip.id, 'value', parseInt(e.target.value) || 0)}
      min="0"
      step="1"
      className={`w-20 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
    />
  </div>
														{/* NEW Quantity box */}
<div className="w-40 flex flex-col">
  <label className="text-sm text-gray-300 mb-1">
    Quantity owned
  </label>

  <div className="flex items-center gap-2">
    <input
      type="number"
      min="0"
      className="w-24 px-3 py-2 rounded-md bg-gray-800 text-gray-100 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      value={chip.quantity ?? 0}
      onChange={(e) => {
        const qty = parseInt(e.target.value || '0', 10);
        setChipDenominations(prev =>
          prev.map(c =>
            c.id === chip.id ? { ...c, quantity: isNaN(qty) ? 0 : qty } : c
          )
        );
      }}
    />

    {chipDistribution && (
      <span className="inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-gray-700 text-[11px] text-gray-200">
        {getPerPlayerCountForChip(chip.id)} per player
      </span>
    )}
  </div>
</div>

                                                        <button
                                                            onClick={() => deleteChipDenomination(chip.id)}
                                                            className="px-3 py-1 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                            <button
                                                onClick={addChipDenomination}
                                                className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 mt-4"
                                            >
                                                Add New Chip
                                            </button>
                                        </div>
                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setTournamentSettingsSubView('menu')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setTournamentSettingsSubView('menu');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Chip Settings
                                            </button>
                                        </div>
                                    </>
                                )}

							{/* Logo Settings View for Tournament Clock */}
                                {tournamentSettingsSubView === 'logo' && (
                                    <>
                                        <div className="flex flex-col space-y-4">
                                            <div className="flex items-center justify-between">
                                                <span className={`${subtextColorClass} text-base`}>Show Logo:</span>
                                                <label htmlFor="toggle-logo-tournament" className="flex items-center cursor-pointer">
                                                    <div className="relative">
                                                        <input
                                                            type="checkbox"
                                                            id="toggle-logo-tournament"
                                                            className="sr-only"
                                                            checked={showLogo}
                                                            onChange={(e) => setShowLogo(e.target.checked)}
                                                        />
                                                        <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
                                                        <div className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
                                                            style={{ transform: showLogo ? 'translateX(24px)' : 'translateX(0)' }}></div>
                                                    </div>
                                                </label>
                                            </div>

                                            {showLogo && (
                                                <>
                                                    <div className="flex items-center space-x-2">
                                                        <label htmlFor="logo-url-tournament" className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Custom Logo URL:</label>
                                                        <input
                                                            id="logo-url-tournament"
                                                            type="text"
                                                            value={customLogoUrl}
                                                            onChange={(e) => setCustomLogoUrl(e.target.value)}
                                                            placeholder="e.g., https://example.com/logo.png"
                                                            className={`flex-grow px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                        />
                                                    </div>
                                                    <div className="flex items-center space-x-2">
                                                        <label className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Logo Height (vh):</label>
                                                        <NumberSpinner
                                                            value={logoHeightVh}
                                                            min={10} max={80} step={1} /* Changed step from 5 to 1 */
                                                            onChange={setLogoHeightVh}
                                                            theme={theme}
                                                            widthClass="w-24"
                                                            textSizeClass="text-xl"
                                                        />
                                                    </div>
                                                    <div className="flex items-center space-x-2">
                                                        <label className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Logo Top Offset (vh):</label>
                                                        <NumberSpinner
                                                            value={logoTopOffset}
                                                            min={0} max={90} step={1}
                                                            onChange={setLogoTopOffset}
                                                            theme={theme}
                                                            widthClass="w-24"
                                                            textSizeClass="text-xl"
                                                        />
                                                    </div>
                                                    <div className="flex items-center space-x-2">
                                                        <label className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Logo Right Offset (vw):</label>
                                                        <NumberSpinner
                                                            value={logoRightOffset} // Use right offset state
                                                            min={0} max={90} step={1}
                                                            onChange={setLogoRightOffset} // Update right offset state
                                                            theme={theme}
                                                            widthClass="w-24"
                                                            textSizeClass="text-xl"
                                                        />
                                                    </div>
                                                </>
                                            )}
                                        </div>

                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setTournamentSettingsSubView('menu')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setTournamentSettingsSubView('menu');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Logo Settings
                                            </button>
                                        </div>
                                    </>
                                )}


                                {/* Theme Settings View for Tournament Clock */}
                                {tournamentSettingsSubView === 'theme' && (
                                    <>
                                        <div className="flex flex-col space-y-4">
                                            <div className="flex items-center justify-between">
                                                <span className={`${subtextColorClass} text-base`}>Toggle Theme:</span>
                                                <button
                                                    onClick={() => onThemeChange(theme === 'dark' ? 'light' : 'dark')}
                                                    className={`${sectionBgClass} p-3 rounded-full shadow-md transition-all duration-200 hover:scale-105`}
                                                    title="Toggle Theme"
                                                >
                                                    {theme === 'dark' ? (
                                                        <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 text-yellow-300`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.325 3.325l-.707.707M6.319 6.319l-.707-.707m12.728 0l-.707.707M6.319 17.681l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                                        </svg>
                                                    ) : (
                                                        <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 text-gray-800`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                                                        </svg>
                                                    )}
                                                </button>
                                            </div>
                                        </div>
                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setTournamentSettingsSubView('menu')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setTournamentSettingsSubView('menu');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Theme Settings
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}
                    <audio ref={audioRef} src="https://quicksounds.com/uploads/tracks/1098360932_1903340572_1377612226.mp3" preload="auto"></audio>
                </div>
            );
        };

        /**
         * HighHandTimerView Component
         * Encapsulates the entire High Hand Poker Timer functionality.
         * This is essentially the previous App component content, refactored into its own component.
         * @param {object} props - Component props.
         * @param {string} props.theme - Current theme ('light' or 'dark') for styling.
         * @param {string} props.appBgClass - Tailwind class for overall app background.
         * @param {string} props.mainCardBgClass - Tailwind class for main card background.
         * @param {string} props.sectionBgClass - Tailwind class for section backgrounds.
         * @param {string} props.inputBgClass - Tailwind class for input backgrounds.
         * @param {string} props.inputBorderClass - Tailwind class for input borders.
         * @param {string} props.subtextColorClass - Tailwind class for secondary text color.
         * @param {string} props.placeholderColorClass - Tailwind class for placeholder text color.
         * @param {string} props.headingTextColorClass - Tailwind class for heading text color.
         * @param {function} props.onBackToHome - Callback to navigate back to the HomeView.
         * @param {function} props.onThemeChange - Callback to change theme (passed from parent App).
         */
        const HighHandTimerView = ({ theme, appBgClass, mainCardBgClass, sectionBgClass, inputBgClass, inputBorderClass, subtextColorClass, placeholderColorClass, headingTextColorClass, onBackToHome, onThemeChange }) => {
            // All states and effects from the original App component related to High Hand Timer
            const [showSettings, setShowSettings] = useState(false);
            const [highHandSettingsSubView, setHighHandSettingsSubView] = useState('main'); // 'main', 'logo', 'jackpot', 'additionalGames', 'chipSettings'
            const [showAddManageHands, setShowAddManageHands] = useState(false);
            const [isFullscreen, setIsFullscreen] = useState(false);
            const [timeRemaining, setTimeRemaining] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const [inputDuration, setInputDuration] = useState(60); // Changed default from 30 to 60
            const [pokerHands, setPokerHands] = useState([]);
            const [currentHighHandId, setCurrentHighHandId] = useState(null);
            const [currentHandSelection, setCurrentHandSelection] = useState([]);
            // Renamed tempSelectedRank/Suit for High Hand specific use
            const [highHandSelectedRank, setHighHandSelectedRank] = useState('');
            const [highHandSelectedSuit, setHighHandSelectedSuit] = useState('');
            const [handOwnerInput, setHandOwnerInput] = useState('');
            const [showLogo, setShowLogo] = useState(true);
            const [logoHeightVh, setLogoHeightVh] = useState(15); // Changed default from 25 to 15
            const [customLogoUrl, setCustomLogoUrl] = useState('');
            const [logoTopOffset, setLogoTopOffset] = useState(4);
            const [logoLeftOffset, setLogoLeftOffset] = useState(12); // Changed default from 4 to 12

            // New state for editable High Hand Timer title
            const [highHandTitle, setHighHandTitle] = useState(() => localStorage.getItem('highHandTitle') || 'High Hand Timer');
            // New states for Bad Beat Jackpot
            const [badBeatJackpotAmount, setBadBeatJackpotAmount] = useState(() => parseInt(localStorage.getItem('badBeatJackpotAmount') || '0'));
            // State for controlling Bad Beat Jackpot display visibility
            const [showBadBeatJackpot, setShowBadBeatJackpot] = useState(() => {
                const savedDisplay = localStorage.getItem('showBadBeatJackpot');
                return savedDisplay !== null ? JSON.parse(savedDisplay) : true; // Default to true if not set
            });
            // State for Bad Beat Jackpot Qualification Hand (array of card strings)
            const [badBeatQualificationHand, setBadBeatQualificationHand] = useState(() => {
                const savedHand = localStorage.getItem('badBeatQualificationHand');
                return savedHand ? JSON.parse(savedHand) : null;
            });
            // State for the derived Bad Beat Qualification string (e.g., "Aces Full of Kings")
            const [badBeatQualification, setBadBeatQualification] = useState(() => localStorage.getItem('badBeatQualification') || 'Not Set');
            // State to control visibility of the Bad Beat hand selector modal
            const [showBadBeatHandSelector, setShowBadBeatHandSelector] = useState(false);
            // Temporary state for building the Bad Beat hand in the selector
            const [tempBadBeatSelection, setTempBadBeatSelection] = useState([]);
            // New temporary states for selecting rank/suit within the Bad Beat selector
            const [badBeatSelectedRank, setBadBeatSelectedRank] = useState('');
            const [badBeatSelectedSuit, setBadBeatSelectedSuit] = useState('');

            // New states for Chip Denominations
            const defaultChipDenominations = [
                { id: crypto.randomUUID(), color: '#FFFFFF', value: 1 }, // White
                { id: crypto.randomUUID(), color: '#FF0000', value: 5 },  // Red
                { id: crypto.randomUUID(), color: '#0000FF', value: 10 }, // Blue
                { id: crypto.randomUUID(), color: '#008000', value: 25 }, // Green
                { id: crypto.randomUUID(), color: '#000000', value: 100 },// Black
            ];
            const [chipDenominations, setChipDenominations] = useState(() => {
                const savedChips = localStorage.getItem('pokerChipDenominations');
                return savedChips ? JSON.parse(savedChips) : defaultChipDenominations;
            });
            const [showChipDisplay, setShowChipDisplay] = useState(() => {
                const savedShowChipDisplay = localStorage.getItem('showPokerChipDisplay');
                return savedShowChipDisplay !== null ? JSON.parse(savedShowChipDisplay) : true;
            });
const [show7DeuceGame, setShow7DeuceGame] = useState(false);
const [showNitGame, setShowNitGame] = useState(false);
const [showSquidGame, setShowSquidGame] = useState(false);

const [sevenDeuceBounty, setSevenDeuceBounty] = useState('');
const [nitGameBounty, setNitGameBounty] = useState('');
const [squidGameBounty, setSquidGameBounty] = useState('');


			


            // Pre-defined colors for chip denominations
            const predefinedColors = [
                { name: 'White', hex: '#FFFFFF' },
                { name: 'Red', hex: '#FF0000' },
                { name: 'Green', hex: '#008000' },
                { name: 'Blue', hex: '#0000FF' },
                { name: 'Black', hex: '#000000' },
                { name: 'Gray', hex: '#808080' },
                { name: 'Orange', hex: '#FFA500' },
                { name: 'Pink', hex: '#FFC0CB' },
                { name: 'Yellow', hex: '#FFFF00' },
                { name: 'Purple', hex: '#800080' },
                { name: 'Light Blue', hex: '#ADD8E6' },
                { name: 'Cyan', hex: '#00FFFF' },
                { name: 'Magenta', hex: '#FF00FF' },
                { name: 'Lime', hex: '#00FF00' },
                { name: 'Teal', hex: '#008080' },
                { name: 'Indigo', hex: '#4B0082' },
                { name: 'Brown', hex: '#A52A2A' },
                { name: 'Gold', hex: '#FFD700' },
                { name: 'Silver', hex: '#C0C0C0' },
                { name: 'Maroon', hex: '#800000' },
            ];


            // DEFAULT LOGO URL
            const defaultLogoUrl = "https://i.imgur.com/bCHijGi.png"; // Updated logo URL
            const logoToDisplay = customLogoUrl || defaultLogoUrl;

            const timerRef = useRef(null);
            const audioRef = useRef(null); // For sound effects
            const ranks = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];
            // Updated: Define a map for suit display characters and their colors for the buttons
            const suitDisplayInfo = {
                'S': { symbol: '♠', color: 'text-gray-900' },
                'H': { symbol: '♥', color: 'text-red-500' },
                'D': { symbol: '♦', color: 'text-red-500' },
                'C': { symbol: '♣', color: 'text-gray-900' }
            };
            const suits = Object.keys(suitDisplayInfo); // Keep internal logic with ['S', 'H', 'D', 'C']

            // Helper function to map numeric rank values back to display strings
            const getRankDisplayName = (rankValue) => {
                switch (rankValue) {
                    case 14: return 'Ace';
                    case 13: return 'King';
                    case 12: return 'Queen';
                    case 11: return 'Jack';
                    case 10: return '10';
                    default: return String(rankValue);
                }
            };

            const evaluateHand = (cardsArray) => {
                if (!Array.isArray(cardsArray) || cardsArray.length !== 5) { return "Invalid Hand (must be 5 cards)"; }
                const rankValues = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, 'T': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14 };
                let ranksInHand = cardsArray.map(card => rankValues[card.slice(0, -1)]);
                let suitsInHand = cardsArray.map(card => card.slice(-1));
                ranksInHand.sort((a, b) => a - b);
                const rankCounts = {};
                ranksInHand.forEach(rank => { rankCounts[rank] = (rankCounts[rank] || 0) + 1; });

                const numRanks = Object.keys(rankCounts).length;
                const sortedRankCounts = Object.values(rankCounts).sort((a, b) => b - a);
                const suitCounts = {};
                suitsInHand.forEach(suit => { suitCounts[suit] = (suitCounts[suit] || 0) + 1; });
                const isFlush = Object.values(suitCounts).some(count => count >= 5);
                
                let isStraight = true;
                for (let i = 0; i < ranksInHand.length - 1; i++) { if (ranksInHand[i+1] - ranksInHand[i] !== 1) { isStraight = false; break; } }
                // Handle Ace-low straight (A, 2, 3, 4, 5)
                if (!isStraight && ranksInHand.includes(14) && ranksInHand.includes(2) && ranksInHand.includes(3) && ranksInHand.includes(4) && ranksInHand.includes(5) && numRanks === 5) { isStraight = true; }

                // Get ranks present in the hand for specific descriptions
                const countedRanks = Object.keys(rankCounts).map(Number).sort((a, b) => b - a); // Descending order of rank values

                // Detailed hand evaluation for display
                if (isStraight && isFlush) {
                    if (ranksInHand[0] === 10 && ranksInHand[4] === 14) return "Royal Flush";
                    return `${getRankDisplayName(ranksInHand[4])} High Straight Flush`;
                }
                if (sortedRankCounts[0] === 4) {
                    const quadRank = getRankDisplayName(countedRanks.find(r => rankCounts[r] === 4));
                    return `Quad ${quadRank}s`;
                }
                if (sortedRankCounts[0] === 3 && sortedRankCounts[1] === 2) {
                    const tripsRank = getRankDisplayName(countedRanks.find(r => rankCounts[r] === 3));
                    const pairRank = getRankDisplayName(countedRanks.find(r => rankCounts[r] === 2));
                    return `${tripsRank}s full of ${pairRank}s`;
                }
                if (isFlush) {
                    return `${getRankDisplayName(ranksInHand[4])} High Flush`;
                }
                if (isStraight) {
                    return `${getRankDisplayName(ranksInHand[4])} High Straight`;
                }
                if (sortedRankCounts[0] === 3) {
                    const tripsRank = getRankDisplayName(countedRanks.find(r => rankCounts[r] === 3));
                    return `Three of a Kind: ${tripsRank}s`;
                }
                if (sortedRankCounts[0] === 2 && sortedRankCounts[1] === 2) {
                    const pairs = countedRanks.filter(r => rankCounts[r] === 2);
                    const highPair = getRankDisplayName(pairs[0]);
                    const lowPair = getRankDisplayName(pairs[1]);
                    return `Two Pair: ${highPair}s and ${lowPair}s`;
                }
                if (sortedRankCounts[0] === 2) {
                    const pairRank = getRankDisplayName(countedRanks.find(r => rankCounts[r] === 2));
                    return `Pair of ${pairRank}s`;
                }
                return `High Card ${getRankDisplayName(ranksInHand[4])}`;
            };

            // Load settings and hands from localStorage
            useEffect(() => {
                const savedDuration = localStorage.getItem('pokerTimerDuration');
                if (savedDuration) setInputDuration(parseInt(savedDuration));
                let loadedPokerHands = [];
                try {
                    const savedHands = localStorage.getItem('pokerHands');
                    if (savedHands) {
                        loadedPokerHands = JSON.parse(savedHands);
                        if (!Array.isArray(loadedPokerHands)) { console.error("Parsed pokerHands from localStorage is not an array. Resetting."); loadedPokerHands = []; }
                    }
                } catch (e) { console.error("Failed to parse pokerHands from localStorage:", e); loadedPokerHands = []; }
                setPokerHands(loadedPokerHands);
                const savedHighHandId = localStorage.getItem('currentHighHandId');
                if (savedHighHandId && savedHighHandId !== 'null' && savedHighHandId !== 'undefined') { setCurrentHighHandId(savedHighHandId); } else { setCurrentHighHandId(null); }
                const savedShowLogo = localStorage.getItem('pokerTimerShowLogo');
                if (savedShowLogo !== null) setShowLogo(JSON.parse(savedShowLogo));
                const savedLogoHeight = localStorage.getItem('pokerTimerLogoHeightVh');
                if (savedLogoHeight !== null) setLogoHeightVh(parseInt(savedLogoHeight));
                const savedCustomLogoUrl = localStorage.getItem('pokerTimerCustomLogoUrl');
                // FIX: Correctly set the state from localStorage
                if (savedCustomLogoUrl) { setCustomLogoUrl(savedCustomLogoUrl); }
                const savedLogoTopOffset = localStorage.getItem('pokerTimerLogoTopOffset');
                if (savedLogoTopOffset !== null) { setLogoTopOffset(parseInt(savedLogoTopOffset)); }
                const savedLogoLeftOffset = localStorage.getItem('pokerTimerLogoLeftOffset');
                if (savedLogoLeftOffset !== null) { setLogoLeftOffset(parseInt(savedLogoLeftOffset)); }
                // Load high hand title
                const savedHighHandTitle = localStorage.getItem('highHandTitle');
                if (savedHighHandTitle) setHighHandTitle(savedHighHandTitle);
                // Load Bad Beat Jackpot settings
                const savedJackpotAmount = localStorage.getItem('badBeatJackpotAmount');
                if (savedJackpotAmount !== null) setBadBeatJackpotAmount(parseInt(savedJackpotAmount));
                // Load showBadBeatJackpot state
                const savedShowBadBeatJackpot = localStorage.getItem('showBadBeatJackpot');
                if (savedShowBadBeatJackpot !== null) setShowBadBeatJackpot(JSON.parse(savedShowBadBeatJackpot));
                // Load Bad Beat Qualification Hand
                const savedBadBeatHand = localStorage.getItem('badBeatQualificationHand');
                if (savedBadBeatHand) {
                    try {
                        const parsedBadBeatHand = JSON.parse(savedBadBeatHand);
                        if (Array.isArray(parsedBadBeatHand)) {
                            setBadBeatQualificationHand(parsedBadBeatHand);
                        } else {
                            setBadBeatQualificationHand(null);
                        }
                    } catch (e) {
                        console.error("Failed to parse badBeatQualificationHand from localStorage:", e);
                        setBadBeatQualificationHand(null);
                    }
                } else {
                    setBadBeatQualificationHand(null);
                }
                // Load Chip Denominations
                const savedChipDenominations = localStorage.getItem('pokerChipDenominations');
                if (savedChipDenominations) {
                    try {
                        const parsedChips = JSON.parse(savedChipDenominations);
                        if (Array.isArray(parsedChips)) {
                            setChipDenominations(parsedChips);
                        }
                    } catch (e) {
                        console.error("Failed to parse pokerChipDenominations from localStorage:", e);
                    }
                }
                const savedShowChipDisplay = localStorage.getItem('showPokerChipDisplay');
                if (savedShowChipDisplay !== null) setShowChipDisplay(JSON.parse(savedShowChipDisplay));


            }, []);
// Load on mount
useEffect(() => {
  const saved7Deuce = localStorage.getItem('show7DeuceGame');
  if (saved7Deuce !== null) setShow7DeuceGame(JSON.parse(saved7Deuce));
  
  const savedNit = localStorage.getItem('showNitGame');
  if (savedNit !== null) setShowNitGame(JSON.parse(savedNit));
  
  const savedSquid = localStorage.getItem('showSquidGame');
  if (savedSquid !== null) setShowSquidGame(JSON.parse(savedSquid));
}, []);

// Save on change
useEffect(() => { localStorage.setItem('show7DeuceGame', JSON.stringify(show7DeuceGame)); }, [show7DeuceGame]);
useEffect(() => { localStorage.setItem('showNitGame', JSON.stringify(showNitGame)); }, [showNitGame]);
useEffect(() => { localStorage.setItem('showSquidGame', JSON.stringify(showSquidGame)); }, [showSquidGame]);

            // Save settings and hands to localStorage
            useEffect(() => {
                localStorage.setItem('pokerTimerDuration', inputDuration.toString());
                localStorage.setItem('pokerHands', JSON.stringify(pokerHands));
                localStorage.setItem('currentHighHandId', currentHighHandId);
                localStorage.setItem('pokerTimerShowLogo', JSON.stringify(showLogo));
                localStorage.setItem('pokerTimerLogoHeightVh', logoHeightVh.toString());
                if (customLogoUrl) { localStorage.setItem('pokerTimerCustomLogoUrl', customLogoUrl); } else { localStorage.removeItem('pokerTimerCustomLogoUrl'); }
                localStorage.setItem('pokerTimerLogoTopOffset', logoTopOffset.toString());
                localStorage.setItem('pokerTimerLogoLeftOffset', logoLeftOffset.toString());
                localStorage.setItem('highHandTitle', highHandTitle);
                // Save Bad Beat Jackpot settings
                localStorage.setItem('badBeatJackpotAmount', badBeatJackpotAmount.toString());
                localStorage.setItem('showBadBeatJackpot', JSON.stringify(showBadBeatJackpot));
                localStorage.setItem('badBeatQualificationHand', JSON.stringify(badBeatQualificationHand));
                // Save Chip Denominations
                localStorage.setItem('pokerChipDenominations', JSON.stringify(chipDenominations));
                localStorage.setItem('showPokerChipDisplay', JSON.stringify(showChipDisplay));

            }, [inputDuration, pokerHands, currentHighHandId, showLogo, logoHeightVh, customLogoUrl, logoTopOffset, logoLeftOffset, highHandTitle, badBeatJackpotAmount, showBadBeatJackpot, badBeatQualificationHand, chipDenominations, showChipDisplay]);

            // Effect to derive badBeatQualification string from badBeatQualificationHand
            useEffect(() => {
                if (badBeatQualificationHand && badBeatQualificationHand.length === 5) {
                    setBadBeatQualification(evaluateHand(badBeatQualificationHand));
                } else {
                    setBadBeatQualification('Not Set');
                }
            }, [badBeatQualificationHand]);

            // Fullscreen change listener
            useEffect(() => {
                const handleFullscreenChange = () => setIsFullscreen(!!document.fullscreenElement);
                document.addEventListener('fullscreenchange', handleFullscreenChange);
                document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
                document.addEventListener('mozfullscreenchange', handleFullscreenChange);
                document.addEventListener('MSFullscreenChange', handleFullscreenChange);
                return () => {
                    document.removeEventListener('fullscreenchange', handleFullscreenChange);
                    document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);
                    document.removeEventListener('mozfullscreenchange', handleFullscreenChange);
                    document.removeEventListener('MSFullscreenChange', handleFullscreenChange);
                };
            }, []);

            const toggleFullscreen = () => {
                try {
                    if (!document.fullscreenElement) {
                        if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
                        else if (document.documentElement.mozRequestFullScreen) document.documentElement.mozRequestFullScreen();
                        else if (document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
                        else if (document.documentElement.msRequestFullscreen) document.documentElement.msRequestFullscreen();
                    } else {
                        if (document.exitFullscreen) document.exitFullscreen();
                        else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                        else if (document.webkitExitFullscreen) document.exitFullscreen();
                        else if (document.documentElement.msExitFullscreen) document.documentElement.msExitFullscreen();
                    }
                } catch (error) { /* console.error("Fullscreen API error:", error); */ }
            };

            // Timer interval logic
            useEffect(() => {
                if (isRunning && timeRemaining > 0) {
                    timerRef.current = setInterval(() => setTimeRemaining((prevTime) => prevTime - 1), 1000);
                } else if (timeRemaining === 0) {
                    clearInterval(timerRef.current);
                    setIsRunning(false);
                }
                return () => clearInterval(timerRef.current);
            }, [isRunning, timeRemaining]);

            const startTimer = () => {
                if (!isRunning && timeRemaining > 0) setIsRunning(true);
                else if (!isRunning && timeRemaining === 0 && inputDuration > 0) {
                    setTimeRemaining(inputDuration * 60);
                    setIsRunning(true);
                }
            };

            const pauseTimer = () => {
                setIsRunning(false);
                clearInterval(timerRef.current);
            };

            const resetTimer = () => {
                setIsRunning(false);
                clearInterval(timerRef.current);
                setTimeRemaining(inputDuration * 60);
            };

            const handleDurationChange = (param) => {
                let duration;
                if (typeof param === 'object' && param !== null && param.target) {
                    duration = parseInt(param.target.value);
                } else {
                    duration = parseInt(param);
                }
                
                if (!isNaN(duration) && duration >= 0) {
                    setInputDuration(duration);
                    if (timerRef.current) { clearInterval(timerRef.current); }
                    if (isRunning || (timeRemaining === 0 && duration > 0)) {
                        setTimeRemaining(duration * 60);
                        setIsRunning(true);
                        timerRef.current = setInterval(() => setTimeRemaining((prevTime) => prevTime - 1), 1000);
                    } else { setTimeRemaining(duration * 60); }
                } else if ((typeof param === 'object' && param.target && param.target.value === '') || param === '') {
                    setInputDuration(''); setTimeRemaining(0); clearInterval(timerRef.current); setIsRunning(false);
                }
            };

            // Helper to remove a card from a selection array
            const handleRemoveCard = (cardToRemove, setCurrentSelection) => {
                setCurrentSelection(prev => prev.filter(card => card !== cardToRemove));
            };

            // Helper to clear temporary selection states and the hand array
            const handleClearSelectionAndStates = (setCurrentSelection, setSelectedRank, setSelectedSuit) => {
                setCurrentSelection([]);
                setSelectedRank('');
                setSelectedSuit('');
            };

            // High Hand specific card selection handlers
            const handleAddHighHandCard = () => {
                if (highHandSelectedRank && highHandSelectedSuit && currentHandSelection.length < 5) {
                    const newCard = `${highHandSelectedRank}${highHandSelectedSuit}`;
                    if (!currentHandSelection.includes(newCard)) {
                        setCurrentHandSelection(prev => [...prev, newCard]);
                        setHighHandSelectedRank(''); // Clear selections for the next card
                        setHighHandSelectedSuit('');
                    }
                }
            };

            const handleClearHighHandSelection = () => {
                handleClearSelectionAndStates(setCurrentHandSelection, setHighHandSelectedRank, setHighHandSelectedSuit);
                setHandOwnerInput(''); // Also clear owner for high hand
            };


            const addHand = () => {
                if (Array.isArray(currentHandSelection) && currentHandSelection.length === 5) {
                    const determinedHandType = evaluateHand(currentHandSelection);
                    const newHand = { id: Date.now().toString(), cards: currentHandSelection.join(' ').trim(), owner: handOwnerInput.trim() || 'Unknown Player', type: determinedHandType };
                    setPokerHands((prevHands) => [...prevHands, newHand]);
                    // Re-added: Automatically set the newly added hand as the current high hand
                    setCurrentHighHandId(newHand.id);
                    handleClearHighHandSelection();
                }
            };

            const designateHighHand = (handId) => setCurrentHighHandId(handId);
            const removeHand = (handId) => {
                setPokerHands((prevHands) => (Array.isArray(prevHands) ? prevHands.filter((hand) => hand.id !== handId) : []));
                if (currentHighHandId === handId) setCurrentHighHandId(null);
            };

            // New function to clear the current high hand from display without deleting it
            const handleClearCurrentHighHandDisplay = () => {
                setCurrentHighHandId(null);
            };

            const highHand = Array.isArray(pokerHands) ? pokerHands.find((hand) => hand.id === currentHighHandId) : undefined;

            const getLogoStyle = (topOffset, leftOffset, rightOffset) => {
                const style = {
                    top: `${topOffset}vh`,
                    position: 'absolute'
                };
                if (leftOffset !== undefined) {
                    style.left = `${leftOffset}vw`;
                } else if (rightOffset !== undefined) {
                    style.right = `${rightOffset}vw`;
                }
                return style;
            };

            // Bad Beat specific card selection handlers
            const handleAddBadBeatCard = () => {
                if (badBeatSelectedRank && badBeatSelectedSuit && tempBadBeatSelection.length < 5) {
                    const newCard = `${badBeatSelectedRank}${badBeatSelectedSuit}`;
                    if (!tempBadBeatSelection.includes(newCard)) {
                        setTempBadBeatSelection(prev => [...prev, newCard]);
                        setBadBeatSelectedRank(''); // Clear selections for the next card
                        setBadBeatSelectedSuit('');
                    }
                }
            };

            // Handle confirm for Bad Beat Qualification Hand
            const handleConfirmBadBeatHand = () => {
                if (tempBadBeatSelection.length === 5) {
                    setBadBeatQualificationHand(tempBadBeatSelection);
                    setShowBadBeatHandSelector(false);
                    // Clear temporary states used for selection after confirming
                    handleClearSelectionAndStates(setTempBadBeatSelection, setBadBeatSelectedRank, setBadBeatSelectedSuit);
                }
            };

            const handleClearBadBeatHand = () => {
                setBadBeatQualificationHand(null);
                // Also clear temporary states if the main qualification hand is cleared
                handleClearSelectionAndStates(setTempBadBeatSelection, setBadBeatSelectedRank, setBadBeatSelectedSuit);
            };

            // Chip Denomination handlers
            const addChipDenomination = () => {
                setChipDenominations(prevChips => [
                    ...prevChips,
                    { id: crypto.randomUUID(), color: '#CCCCCC', value: 0 } // Default new chip
                ]);
            };

            const updateChipDenomination = (id, field, value) => {
                setChipDenominations(prevChips =>
                    prevChips.map(chip =>
                        chip.id === id ? { ...chip, [field]: (field === 'value' ? parseFloat(value) || 0 : value) } : chip
                    )
                );
            };

            const deleteChipDenomination = (id) => {
                setChipDenominations(prevChips => prevChips.filter(chip => chip.id !== id));
            };
			
			const handleHighHandBackToMain = () => {
			  // Option A: if high hand is its own view
			  onBackToHome && onBackToHome();

			  // Option B: if you just close the settings modal/panel
			  setShowHighHandSettings(false);
			};
const [showHighHandSettings, setShowHighHandSettings] = useState(false);

       return (
                <div className={`${mainCardBgClass} p-5 rounded-2xl shadow-2xl w-full max-w-md md:max-w-4xl lg:max-w-6xl flex flex-col transition-colors duration-500 relative`}>
                    {/* Back to Home Button */}
                    <button
                        onClick={onBackToHome}
                        className="absolute top-4 left-4 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200 z-10"
                    >
                        &larr; Home
                    </button>

                    {showLogo && (
                        <img
                            src={logoToDisplay}
                            alt="Custom Logo"
                            style={{ maxHeight: `${logoHeightVh}vh`, ...getLogoStyle(logoTopOffset, logoLeftOffset, undefined) }}
                            className="w-auto object-contain"
                            onError={(e) => {
                                e.target.onerror = null;
                                e.target.src = 'https://placehold.co/192x96/cccccc/333333?text=Logo+Error';
                                e.target.alt = "Logo could not be loaded";
                                e.target.style.maxHeight = `${logoHeightVh}vh`;
                                Object.assign(e.target.style, getLogoStyle(logoTopOffset, logoLeftOffset, undefined));
                            }}
                        />
                    )}
					

                    {/* New: Display Bad Beat Jackpot amount and qualification */}
                    {showBadBeatJackpot && (
                        <div className={`absolute top-2 right-2 p-3 rounded-lg border border-red-500 ${inputBgClass} transition-colors duration-500 z-10 text-center`}>
                            <h3 className={`text-lg font-medium mb-1 font-outfit ${headingTextColorClass}`}>Bad Beat Jackpot: <span className="font-semibold text-green-400">${badBeatJackpotAmount.toLocaleString()}</span></h3>
                            <p className={`text-base font-medium ${subtextColorClass}`}>Qualification: <span className="font-semibold">{badBeatQualification}</span></p>
                        </div>
						
                    )}
					{(show7DeuceGame || showNitGame || showSquidGame) && (
    <div className="absolute top-20 right-1 p-3">
      <div className="px-2 py-2 rounded-lg border border-green-500 sectionBgClass transition-colors duration-500">
        

    {show7DeuceGame && (
  <div className="mb-1">
    <div className="flex items-baseline justify-end gap-2">
      <p className={`${subtextColorClass} text-sm font-medium`}>
        7 Deuce Game is <span className="font-semibold text-m text-yellow-400">ON</span>
      </p>
      {sevenDeuceBounty !== '' && (
        <p className={`${subtextColorClass} text-xs`}>
          Bounty: <span className="font-semibold text-m text-green-400">${Number(sevenDeuceBounty).toLocaleString()}</span>
        </p>
      )}
    </div>
  </div>
)}

    {showNitGame && (
      <div className="mb-1">
	  <div className="flex items-baseline justify-end gap-2">
	  <p className={`${subtextColorClass} text-sm font-medium`}>
        Nit Game is <span className="font-semibold text-m text-yellow-400">ON</span>
		</p>
        {nitGameBounty !== '' && (
          <p className={`${subtextColorClass} text-xs`}>
            Bounty: <span className="font-semibold text-m text-green-400">${Number(nitGameBounty).toLocaleString()}</span>
          </p>
        )}
		</div>
      </div>
    )}

    {showSquidGame && (
      <div className="mb-1">
	  <div className="flex items-baseline justify-end gap-2">
        <p className={`${subtextColorClass} text-sm font-medium`}>
		Squid Game is <span className="font-semibold text-m text-yellow-400">ON</span>
		</p>
        {squidGameBounty !== '' && (
          <p className={`${subtextColorClass} text-xs`}>
            Bounty: <span className="font-semibold text-m text-green-400">${Number(squidGameBounty).toLocaleString()}</span>
          </p>
        )}
      </div>
	  </div>
    )}
  </div>
  </div>
)}

                    <div className="w-full flex flex-col items-center justify-center mb-3"> {/* Reduced mb-4 to mb-3 */}
                        <h1 className={`text-4xl font-bold text-center mb-3 font-outfit ${headingTextColorClass}`}>{highHandTitle}</h1> {/* Replaced static title with state variable */}
                        <div className="text-center mb-4 w-full"> {/* Reduced mb-6 to mb-4 */}
                            <div className={`text-6xl md:text-7xl font-sans tracking-wide ${sectionBgClass} px-4 py-1 rounded-xl shadow-inner inline-block transition-colors duration-500`}> {/* Reduced py-2 to py-1. Font size adjustment */}
                                {formatTime(timeRemaining)}
                            </div>
                        </div>
                        <div className="flex justify-center space-x-3 w-full mt-3">
  <button
    onClick={startTimer}
    disabled={isRunning || (timeRemaining === 0 && inputDuration === 0)}
    className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-semibold rounded-md shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
  >
    Start
  </button>
  <button
    onClick={pauseTimer}
    disabled={!isRunning}
    className="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white text-sm font-semibold rounded-md shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
  >
    Pause
  </button>
  <button
    onClick={resetTimer}
    disabled={timeRemaining === inputDuration * 60 && !isRunning}
    className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-md shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
  >
    Reset
  </button>
</div>

                    </div>

                    <div className="w-full flex flex-col items-center justify-center mt-3 mb-3"> {/* Reduced mt-4 mb-4 to mt-3 mb-3 */}
                        <h3 className={`text-lg font-medium mb-1 font-outfit ${headingTextColorClass}`}>Current High Hand: {highHand && highHand.owner && (<span className={`text-lg font-semibold ${subtextColorClass} ml-2`}>{highHand.owner}</span>)}</h3> {/* Reduced text-xl to text-lg and mb-2 to mb-1 */}
                        {highHand && highHand.type && (<p className={`text-base font-medium ${subtextColorClass} mb-1`}>Type: <span className="font-semibold">{highHand.type}</span></p>)} {/* Reduced text-lg to text-base and mb-2 to mb-1 */}
                        <div className={`p-3 rounded-lg border border-yellow-500 ${inputBgClass} flex justify-center w-full transition-colors duration-500 mx-auto`}> {/* Reduced p-4 to p-3 */}
                            <div className="flex flex-wrap justify-center items-center min-h-[80px] w-full">
                                {highHand ? (<HandDisplay handString={highHand.cards} isLarge={true} />) : (<p className={`text-xl font-semibold text-center ${placeholderColorClass}`}>No high hand set</p>)}
                            </div>
                        </div>
                    </div>

                    {/* Add/Manage Hands Button (Moved) */}
                    <button onClick={() => setShowAddManageHands(true)} className="w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 mb-4">Add/Manage Hands</button>

                    {/* New: Container for Chip Denominations Display and Settings/Fullscreen Buttons */}
                    <div className="flex flex-col sm:flex-row justify-between items-center w-full mt-4">
                        {showChipDisplay && (
                            <div className={`p-3 rounded-lg ${sectionBgClass} flex flex-wrap justify-center sm:justify-start items-center gap-4 transition-colors duration-500 flex-grow`}>
                                <h3 className={`text-xl font-bold ${headingTextColorClass} mr-4`}>Chip Values:</h3>
                                {chipDenominations.sort((a, b) => a.value - b.value).map(chip => (
                                    <div key={chip.id} className="flex flex-col items-center">
                                        {/* Increased font size for chip symbol and value */}
                                        <span className={`text-5xl font-bold`} style={{ color: chip.color }}>◎</span>
                                        <span className={`${subtextColorClass} text-base`}>${chip.value.toLocaleString()}</span>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Settings and Fullscreen buttons (Moved to be inline with chip display) */}
                        <div className="flex justify-end space-x-4 flex-shrink-0 mt-4 sm:mt-0">
                            <button onClick={() => { setShowSettings(true); setHighHandSettingsSubView('main'); }} className={`${sectionBgClass} p-3 rounded-full shadow-md transition-all duration-200 hover:scale-105`}>
                                <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${subtextColorClass}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.39a2 2 0 00.73 2.73l.08.15a2 2 0 010 2l-.15.25a2 2 0 00-.73 2.73l.22.39a2 2 0 012.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 001 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l-.22-.39a2 2 0 00-.73-2.73l-.08-.15a2 2 0 010-2l.15-.25a2 2 0 00.73-2.73l-.22-.39a2 2 0 01-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25A2 2 0 0013 4.18V2a2 2 0 00-2-2z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </button>
                            <button onClick={toggleFullscreen} className={`${sectionBgClass} p-3 rounded-full shadow-md transition-all duration-200 hover:scale-105`}>
                                {isFullscreen ? (
                                    <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${subtextColorClass}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 3h6v6" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 21H3v-6" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3l7.5 7.5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-7.5-7.5" />
                                    </svg>
                                ) : (
                                    <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 ${subtextColorClass}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 2H2v5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M22 7V2h-5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 22h5v-5" />
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2 17v5h5" />
                                    </svg>
                                )}
                            </button>
                        </div>
                    </div>


                    {showSettings && (
                        <div className={`fixed inset-0 ${theme === 'dark' ? 'bg-gray-900 bg-opacity-75' : 'bg-gray-200 bg-opacity-75'} flex items-center justify-center z-50 transition-colors duration-500`}>
                            <div className={`${mainCardBgClass} p-5 rounded-2xl shadow-2xl w-full ${highHandSettingsSubView === 'chipSettings' ? 'max-w-3xl' : 'max-w-md'} overflow-y-auto max-h-[90vh] transition-colors duration-500`}>
                                <h2 className={`text-3xl font-bold text-center mb-6 ${headingTextColorClass}`}>
  {highHandSettingsSubView === 'main' ? 'High Hand Settings' :
   highHandSettingsSubView === 'logo' ? 'Logo Settings' :
   highHandSettingsSubView === 'jackpot' ? 'Bad Beat Jackpot Settings' :
   highHandSettingsSubView === 'additionalGames' ? 'Additional Games' :
   'Chip Denominations'}
</h2>


                                {/* Main High Hand Settings Menu */}
                                {highHandSettingsSubView === 'main' && (
                                    <>
                                        <div className="flex flex-col space-y-4 mb-6">
                                            <div className="flex items-center space-x-2">
                                                <label htmlFor="high-hand-title" className="text-sm font-semibold text-yellow-300 mb-1"
												  >
													High Hand Title
												  </label>
												  <input
                                                    id="high-hand-title"
                                                    type="text"
                                                    value={highHandTitle}
													onChange={(e) => setHighHandTitle(e.target.value)}
													placeholder="Type your high hand promo name here"
													className="px-4 py-2 rounded-md border-2 border-yellow-400 bg-white text-gray-900 text-base font-semibold shadow-sm focus:border-yellow-500 focus:ring-2 focus:ring-yellow-500/60 focus:outline-none"
												  />
												  <p className="mt-1 text-xs text-gray-300">
													This title appears on the High Hand main screen.
												  </p>
												</div>
                                            <div className="flex items-center justify-center space-x-4">
                                                <label htmlFor="timer-duration" className={`${subtextColorClass} text-base whitespace-nowrap`}>Timer Duration (min):</label>
                                                <NumberSpinner
                                                    value={inputDuration}
                                                    min={1} max={999} step={1}
                                                    onChange={handleDurationChange}
                                                    theme={theme}
                                                    widthClass="w-24"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            {/* Theme Toggle Button for High Hand Timer */}
                                            <div className="flex items-center justify-between">
                                                <span className={`${subtextColorClass} text-base`}>Toggle Theme:</span>
                                                <button
                                                    onClick={() => onThemeChange(theme === 'dark' ? 'light' : 'dark')}
                                                    className={`${sectionBgClass} p-3 rounded-full shadow-md transition-all duration-200 hover:scale-105`}
                                                    title="Toggle Theme"
                                                >
                                                    {theme === 'dark' ? (
                                                        <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 text-yellow-300`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.325 3.325l-.707.707M6.319 6.319l-.707-.707m12.728 0l-.707.707M6.319 17.681l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                                        </svg>
                                                    ) : (
                                                        <svg xmlns="http://www.w3.org/2000/svg" className={`h-6 w-6 text-gray-800`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                                                        </svg>
                                                    )}
                                                </button>
                                            </div>
                                        </div>
                                        <div className="flex flex-col space-y-4">
                                            <button onClick={() => setHighHandSettingsSubView('logo')} className="px-6 py-3 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
										  Logo Settings
										</button>
										<button onClick={() => setHighHandSettingsSubView('jackpot')} className="px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
										  Bad Beat Jackpot
										</button>
										<button onClick={() => setHighHandSettingsSubView('additionalGames')} className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
										  Additional Games
										</button>
										<button onClick={() => setHighHandSettingsSubView('chipSettings')} className="px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
										  Chip Denominations
										</button>
										<div className="flex justify-end mt-8">
										  <button onClick={() => {
                                                setShowSettings(false);
                                                setHighHandSettingsSubView('main');
                                            }} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Close
                                            </button>
											</div>
                                        </div>
                                    </>
                                )}

                                {/* Logo Settings for High Hand Timer */}
                                {highHandSettingsSubView === 'logo' && (
                                    <>
                                        <div className="flex flex-col space-y-4 mb-6">
                                            <div className="flex items-center justify-between">
                                                <span className={`${subtextColorClass} text-base`}>Show Logo:</span>
                                                <label htmlFor="toggle-logo-highhand" className="flex items-center cursor-pointer">
                                                    <div className="relative">
                                                        <input
                                                            type="checkbox"
                                                            id="toggle-logo-highhand"
                                                            className="sr-only"
                                                            checked={showLogo}
                                                            onChange={(e) => setShowLogo(e.target.checked)}
                                                        />
                                                        <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
                                                        <div className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
                                                            style={{ transform: showLogo ? 'translateX(24px)' : 'translateX(0)' }}></div>
                                                    </div>
                                                </label>
                                            </div>
                                            {showLogo && (
                                                <>
                                                    <div className="flex items-center space-x-2">
                                                        <label htmlFor="logo-url-highhand" className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Custom Logo URL:</label>
                                                        <input
                                                            id="logo-url-highhand"
                                                            type="text"
                                                            value={customLogoUrl}
                                                            onChange={(e) => setCustomLogoUrl(e.target.value)}
                                                            placeholder="e.e.g., https://example.com/logo.png"
                                                            className={`flex-grow px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                        />
                                                    </div>
                                                    <div className="flex items-center space-x-2">
                                                        <label className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Logo Height (vh):</label>
                                                        <NumberSpinner
                                                            value={logoHeightVh}
                                                            min={10} max={80} step={1}
                                                            onChange={setLogoHeightVh}
                                                            theme={theme}
                                                            widthClass="w-24"
                                                            textSizeClass="text-xl"
                                                        />
                                                    </div>
                                                    <div className="flex items-center space-x-2">
                                                        <label className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Logo Top Offset (vh):</label>
                                                        <NumberSpinner
                                                            value={logoTopOffset}
                                                            min={0} max={90} step={1}
                                                            onChange={setLogoTopOffset}
                                                            theme={theme}
                                                            widthClass="w-24"
                                                            textSizeClass="text-xl"
                                                        />
                                                    </div>
                                                    <div className="flex items-center space-x-2">
                                                        <label className={`${subtextColorClass} text-base whitespace-nowrap w-32`}>Logo Left Offset (vw):</label>
                                                        <NumberSpinner
                                                            value={logoLeftOffset}
                                                            min={0} max={90} step={1}
                                                            onChange={setLogoLeftOffset}
                                                            theme={theme}
                                                            widthClass="w-24"
                                                            textSizeClass="text-xl"
                                                        />
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setHighHandSettingsSubView('main')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setHighHandSettingsSubView('main');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Logo Settings
                                            </button>
                                        </div>
                                    </>
                                )}

                                {/* Bad Beat Jackpot Settings View */}
                   {highHandSettingsSubView === 'jackpot' && (
                                    <>
                                        <div className="flex flex-col space-y-4 mb-6">
                                            <div className="flex items-center space-x-2">
                                                <label htmlFor="jackpot-amount" className={`${subtextColorClass} text-base whitespace-nowrap w-40 text-right`}>Jackpot Amount ($):</label>
                                                <NumberSpinner
                                                    value={badBeatJackpotAmount}
                                                    min={0} max={9999999} step={1}
                                                    onChange={setBadBeatJackpotAmount}
                                                    theme={theme}
                                                    widthClass="w-32"
                                                    textSizeClass="text-xl"
                                                />
                                            </div>
                                            <div className="flex flex-col items-center justify-center space-y-2 mt-4">
                                                <label className={`${subtextColorClass} text-base whitespace-nowrap w-full text-center font-medium`}>Qualification Hand:</label>
                                                <div className={`p-2 rounded-lg border ${inputBorderClass} ${sectionBgClass} w-full flex justify-center items-center min-h-[60px]`}>
                                                    {badBeatQualificationHand && badBeatQualificationHand.length === 5 ? (
                                                        <HandDisplay handString={badBeatQualificationHand.join(' ')} isLarge={false} />
                                                    ) : (
                                                        <p className={`${placeholderColorClass} text-center`}>No hand selected</p>
                                                    )}
                                                </div>
                                                <p className={`${subtextColorClass} text-sm`}>Type: <span className="font-semibold">{badBeatQualification}</span></p>
                                                <div className="flex space-x-2 mt-2">
                                                    <button
                                                        onClick={() => {
                                                            setTempBadBeatSelection(badBeatQualificationHand ? [...badBeatQualificationHand] : []);
                                                            // Ensure temporary selection states are reset when opening the selector
                                                            setBadBeatSelectedRank('');
                                                            setBadBeatSelectedSuit('');
                                                            setShowBadBeatHandSelector(true);
                                                        }}
                                                        className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                                    >
                                                        Select Hand
                                                    </button>
                                                    <button
                                                        onClick={handleClearBadBeatHand}
                                                        disabled={!badBeatQualificationHand}
                                                        className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                                    >
                                                        Clear Hand
                                                    </button>
                                                </div>
                                            </div>

                                            {/* New toggle for showing/hiding Bad Beat Jackpot */}
                                            <div className="flex items-center justify-between mt-4">
                                                <span className={`${subtextColorClass} text-base`}>Show on Main Screen:</span>
                                                <label htmlFor="toggle-bad-beat-jackpot-display" className="flex items-center cursor-pointer">
                                                    <div className="relative">
                                                        <input
                                                            type="checkbox"
                                                            id="toggle-bad-beat-jackpot-display"
                                                            className="sr-only"
                                                            checked={showBadBeatJackpot}
                                                            onChange={(e) => setShowBadBeatJackpot(e.target.checked)}
                                                        />
                                                        <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
                                                        <div className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
                                                            style={{ transform: showBadBeatJackpot ? 'translateX(24px)' : 'translateX(0)' }}></div>
                                                    </div>
                                                </label>
                                            </div>
                                            <div className="flex justify-center mt-4">
                                                <button
                                                    onClick={() => setBadBeatJackpotAmount(0)}
                                                    className="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                                >
                                                    Reset Jackpot
                                                </button>
                                            </div>
                                        </div>
                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setHighHandSettingsSubView('main')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setHighHandSettingsSubView('main');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Jackpot Settings
                                            </button>
                                        </div>
                                    </>
                                )}

{/* FIXED Additional Games Section */}
{highHandSettingsSubView === 'additionalGames' && (
  <div className="flex flex-col space-y-4 mb-6">
    <p className={subtextColorClass + " text-base"}>
      Configure additional game promotions and side bets
    </p>

    {/* 7 Deuce Game */}
    <div className="space-y-1">
      <div className="flex items-center justify-between">
        <span className={`${subtextColorClass} text-base`}>7 Deuce game:</span>
        <label htmlFor="toggle-7deuce" className="flex items-center cursor-pointer">
          <div className="relative">
            <input
              type="checkbox"
              id="toggle-7deuce"
              className="sr-only"
              checked={show7DeuceGame}
              onChange={(e) => setShow7DeuceGame(e.target.checked)}
            />
            <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
            <div
              className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
              style={{ transform: show7DeuceGame ? 'translateX(24px)' : 'translateX(0)' }}
            ></div>
          </div>
        </label>
      </div>
      <div className="flex items-center justify-between pl-4">
        <span className={`${subtextColorClass} text-sm`}>Bounty amount ($):</span>
        <input
          type="number"
          min="0"
          step="1"
          value={sevenDeuceBounty}
          onChange={(e) => setSevenDeuceBounty(e.target.value)}
          className={`w-24 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
          placeholder="0"
        />
      </div>
    </div>

    {/* Nit Game */}
    <div className="space-y-1">
      <div className="flex items-center justify-between">
        <span className={`${subtextColorClass} text-base`}>Nit game:</span>
        <label htmlFor="toggle-nit" className="flex items-center cursor-pointer">
          <div className="relative">
            <input
              type="checkbox"
              id="toggle-nit"
              className="sr-only"
              checked={showNitGame}
              onChange={(e) => setShowNitGame(e.target.checked)}
            />
            <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
            <div
              className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
              style={{ transform: showNitGame ? 'translateX(24px)' : 'translateX(0)' }}
            ></div>
          </div>
        </label>
      </div>
      <div className="flex items-center justify-between pl-4">
        <span className={`${subtextColorClass} text-sm`}>Bounty amount ($):</span>
        <input
          type="number"
          min="0"
          step="1"
          value={nitGameBounty}
          onChange={(e) => setNitGameBounty(e.target.value)}
          className={`w-24 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
          placeholder="0"
        />
      </div>
    </div>

    {/* Squid Game */}
    <div className="space-y-1">
      <div className="flex items-center justify-between">
        <span className={`${subtextColorClass} text-base`}>Squid game:</span>
        <label htmlFor="toggle-squid" className="flex items-center cursor-pointer">
          <div className="relative">
            <input
              type="checkbox"
              id="toggle-squid"
              className="sr-only"
              checked={showSquidGame}
              onChange={(e) => setShowSquidGame(e.target.checked)}
            />
            <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
            <div
              className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
              style={{ transform: showSquidGame ? 'translateX(24px)' : 'translateX(0)' }}
            ></div>
          </div>
        </label>
      </div>
      <div className="flex items-center justify-between pl-4">
        <span className={`${subtextColorClass} text-sm`}>Bounty amount ($):</span>
        <input
          type="number"
          min="0"
          step="1"
          value={squidGameBounty}
          onChange={(e) => setSquidGameBounty(e.target.value)}
          className={`w-24 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
          placeholder="0"
        />
      </div>
    </div>

    <div className="flex justify-between mt-8">
      <button
        onClick={() => setHighHandSettingsSubView('main')}
        className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
      >
        Back to Main Settings
      </button>
      <button
        onClick={() => { setShowSettings(false); setHighHandSettingsSubView('main'); }}
        className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
      >
        Save Settings
      </button>
    </div>
  </div>
)}



{/* Chip Denominations - existing code continues */}
{highHandSettingsSubView === 'chipSettings' && (
    <>
        {/* your existing chip settings content */}
    </>
)}

                                {/* Chip Denominations Settings View */}
                                {highHandSettingsSubView === 'chipSettings' && (
                                    <>
                                        <div className="flex flex-col space-y-4 mb-6">
                                            <div className="flex items-center justify-between">
                                                <span className={`${subtextColorClass} text-base`}>Show Chip Display:</span>
                                                <label htmlFor="toggle-chip-display" className="flex items-center cursor-pointer">
                                                    <div className="relative">
                                                        <input
                                                            type="checkbox"
                                                            id="toggle-chip-display"
                                                            className="sr-only"
                                                            checked={showChipDisplay}
                                                            onChange={(e) => setShowChipDisplay(e.target.checked)}
                                                        />
                                                        <div className="block bg-gray-600 w-14 h-8 rounded-full transition-colors duration-300"></div>
                                                        <div className="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300 transform"
                                                            style={{ transform: showChipDisplay ? 'translateX(24px)' : 'translateX(0)' }}></div>
                                                    </div>
                                                </label>
                                            </div>

                                            <div className="space-y-4">
                                                {chipDenominations.sort((a, b) => a.value - b.value).map(chip => (
                                                    <div key={chip.id} className={`${sectionBgClass} p-3 rounded-lg shadow-sm flex items-center gap-4`}>
                                                        <span className={`text-3xl font-bold`} style={{ color: chip.color }}>◎</span>
                                                        <div className="flex items-center gap-2 flex-grow">
                                                            <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Color:</label>
                                                            {/* Replaced text input with select dropdown for colors */}
                                                            <select
                                                                value={chip.color}
                                                                onChange={(e) => updateChipDenomination(chip.id, 'color', e.target.value)}
                                                                className={`w-28 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                            >
                                                                {predefinedColors.map(color => (
                                                                    <option key={color.hex} value={color.hex} style={{ backgroundColor: color.hex, color: (color.name === 'Black' || color.name === 'Maroon' || color.name === 'Indigo') ? 'white' : 'black' }}>
                                                                        {color.name}
                                                                    </option>
                                                                ))}
                                                            </select>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <label className={`${subtextColorClass} text-sm whitespace-nowrap`}>Value:</label>
                                                            <input
                                                                type="text" // Changed to type="text" to allow decimals more easily
                                                                value={chip.value}
                                                                onChange={(e) => updateChipDenomination(chip.id, 'value', e.target.value)}
                                                                min="0.01" step="any" // Min set to 0.01, step to any for decimals
                                                                className={`w-24 px-2 py-1 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass}`}
                                                                inputMode="decimal" // Suggests decimal keyboard on mobile
                                                            />
                                                        </div>
                                                        <button
                                                            onClick={() => deleteChipDenomination(chip.id)}
                                                            className="px-3 py-1 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                            <button
                                                onClick={addChipDenomination}
                                                className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200 mt-4"
                                            >
                                                Add New Chip
                                            </button>
                                        </div>
                                        <div className="flex justify-between mt-8">
                                            <button onClick={() => setHighHandSettingsSubView('main')} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Back to Main Settings
                                            </button>
                                            <button onClick={() => {
                                                setShowSettings(false);
                                                setHighHandSettingsSubView('main');
                                            }} className="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                                Save Chip Settings
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Add/Manage Hands Modal (HighHandTimerView) */}
                    {showAddManageHands && (
                        <div className={`fixed inset-0 ${theme === 'dark' ? 'bg-gray-900 bg-opacity-75' : 'bg-gray-200 bg-opacity-75'} flex items-center justify-center z-50 transition-colors duration-500`}>
                            <div className={`${mainCardBgClass} p-5 rounded-2xl shadow-2xl w-full max-w-2xl overflow-y-auto max-h-[90vh] transition-colors duration-500`}>
                                <h2 className={`text-3xl font-bold text-center mb-6 ${headingTextColorClass}`}>Add/Manage Poker Hands</h2>

                                {/* Current Hand Selection for High Hand */}
                                <div className={`mb-6 p-4 rounded-lg border ${inputBorderClass} ${sectionBgClass}`}>
                                    <h3 className={`text-xl font-semibold mb-3 ${headingTextColorClass}`}>Currently Building:</h3>
                                    <div className="flex flex-wrap justify-center items-center gap-2 mb-4 min-h-[60px]">
                                        {currentHandSelection.length > 0 ? (
                                            currentHandSelection.map((card, index) => (
                                                <div key={index} className="relative">
                                                    <CardDisplay cardString={card} isLarge={false} />
                                                    <button
                                                        onClick={() => handleRemoveCard(card, setCurrentHandSelection)}
                                                        className="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold"
                                                    >
                                                        X
                                                    </button>
                                                </div>
                                            ))
                                        ) : (
                                            <p className={`${placeholderColorClass}`}>Select 5 cards below to build a hand.</p>
                                        )}
                                    </div>

                                    {/* Card Selection Grid for High Hand */}
                                    {currentHandSelection.length < 5 && (
                                        <>
                                            <div className="mb-4">
                                                <p className={`${subtextColorClass} text-sm mb-2`}>Select Rank:</p>
                                                <div className="flex flex-wrap gap-2 justify-center">
                                                    {ranks.map(rank => {
                                                        const isDisabled = currentHandSelection.length >= 5 || (highHandSelectedSuit && currentHandSelection.includes(rank + highHandSelectedSuit));
                                                        return (
                                                            <button
                                                                key={rank}
                                                                onClick={() => setHighHandSelectedRank(rank)}
                                                                className={`px-3 py-1 rounded-md text-sm font-semibold
                                                                    ${highHandSelectedRank === rank ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'}
                                                                    ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'}
                                                                `}
                                                                disabled={isDisabled}
                                                            >
                                                                {rank}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            <div>
                                                <p className={`${subtextColorClass} text-sm mb-2`}>Select Suit:</p>
                                                <div className="flex flex-wrap gap-2 justify-center">
                                                    {suits.map(suit => {
                                                        const isDisabled = currentHandSelection.length >= 5 || (highHandSelectedRank && currentHandSelection.includes(highHandSelectedRank + suit));
                                                        return (
                                                            <button
                                                                key={suit}
                                                                onClick={() => setHighHandSelectedSuit(suit)}
                                                                className={`px-3 py-1 rounded-md text-sm font-semibold
                                                                    ${highHandSelectedSuit === suit ? 'bg-blue-600 text-white' : `${inputBgClass} ${suitDisplayInfo[suit].color}`} border ${inputBorderClass}
                                                                    ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'}
                                                                `}
                                                                disabled={isDisabled}
                                                            >
                                                                {suitDisplayInfo[suit].symbol}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            <button
                                                onClick={handleAddHighHandCard}
                                                disabled={!highHandSelectedRank || !highHandSelectedSuit || currentHandSelection.includes(`${highHandSelectedRank}${highHandSelectedSuit}`) || currentHandSelection.length >= 5}
                                                className="px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md disabled:opacity-50 disabled:cursor-not-allowed mt-4"
                                            >
                                                Add Card
                                            </button>
                                        </>
                                    )}

                                    <div className="flex items-center space-x-2 mt-4">
                                        <label htmlFor="hand-owner" className={`${subtextColorClass} text-base whitespace-nowrap`}>Owner Name:</label>
                                        <input
                                            id="hand-owner"
                                            type="text"
                                            value={handOwnerInput}
                                            onChange={(e) => setHandOwnerInput(e.target.value)}
                                            placeholder="Player Name"
                                            className={`flex-grow px-3 py-2 rounded-md ${inputBgClass} ${inputBorderClass} ${subtextColorClass} focus:border-blue-500 focus:outline-none`}
                                        />
                                    </div>

                                    <div className="mt-4 flex justify-center space-x-4">
                                        <button onClick={addHand} disabled={currentHandSelection.length !== 5} className="px-5 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                                            Add Hand
                                        </button>
                                        <button onClick={handleClearHighHandSelection} className="px-5 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold rounded-lg shadow-md">
                                            Clear Selection
                                        </button>
                                    </div>
                                </div>

                                {/* Clear Current High Hand Display Button */}
                                {pokerHands.length > 0 && currentHighHandId && (
                                    <div className="flex justify-center mb-6">
                                        <button
                                            onClick={handleClearCurrentHighHandDisplay}
                                            className="px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg shadow-md transition-all duration-200"
                                        >
                                            Clear Current High Hand Display
                                        </button>
                                    </div>
                                )}

                                {/* List of Added Hands */}
                                <div className={`p-4 rounded-lg border ${inputBorderClass} ${sectionBgClass} mt-6`}>
                                    <h3 className={`text-xl font-semibold mb-3 ${headingTextColorClass}`}>Added Hands:</h3>
                                    {pokerHands.length === 0 ? (
                                        <p className={`${placeholderColorClass} text-center`}>No hands added yet.</p>
                                    ) : (
                                        <ul className="space-y-3">
                                            {pokerHands.map((hand) => (
                                                <li key={hand.id} className="flex flex-col sm:flex-row items-center sm:justify-between p-3 rounded-md bg-gray-500 bg-opacity-20">
                                                    <div className="flex-grow text-center sm:text-left mb-2 sm:mb-0">
                                                        <p className={`font-semibold ${subtextColorClass}`}>{hand.owner}: <span className="font-normal">{hand.type}</span></p>
                                                        <HandDisplay handString={hand.cards} isLarge={false} />
                                                    </div>
                                                    <div className="flex space-x-2 flex-shrink-0">
                                                        <button
                                                            onClick={() => designateHighHand(hand.id)}
                                                            className={`px-3 py-1 rounded-md text-sm font-semibold transition-all duration-200
                                                                ${currentHighHandId === hand.id ? 'bg-yellow-500 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}
                                                            `}
                                                        >
                                                            {currentHighHandId === hand.id ? 'Current High Hand' : 'Set as High Hand'}
                                                        </button>
                                                        <button
                                                            onClick={() => removeHand(hand.id)}
                                                            className="px-3 py-1 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-md text-sm transition-all duration-200"
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                </li>
                                            ))}
                                        </ul>
                                    )}
                                </div>

                                <div className="flex justify-end mt-8">
                                    <button onClick={() => setShowAddManageHands(false)} className="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md transition-all duration-200">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Bad Beat Jackpot Hand Selector Modal */}
                    {showBadBeatHandSelector && (
                        <div className={`fixed inset-0 ${theme === 'dark' ? 'bg-gray-900 bg-opacity-75' : 'bg-gray-200 bg-opacity-75'} flex items-center justify-center z-50 transition-colors duration-500`}>
                            <div className={`${mainCardBgClass} p-5 rounded-2xl shadow-2xl w-full max-w-2xl overflow-y-auto max-h-[90vh] transition-colors duration-500`}>
                                <h2 className={`text-3xl font-bold text-center mb-6 ${headingTextColorClass}`}>Select Bad Beat Qualification Hand</h2>

                                {/* Current Hand Selection for Bad Beat */}
                                <div className={`mb-6 p-4 rounded-lg border ${inputBorderClass} ${sectionBgClass}`}>
                                    <h3 className={`text-xl font-semibold mb-3 ${headingTextColorClass}`}>Currently Building:</h3>
                                    <div className="flex flex-wrap justify-center items-center gap-2 mb-4 min-h-[60px]">
                                        {tempBadBeatSelection.length > 0 ? (
                                            tempBadBeatSelection.map((card, index) => (
                                                <div key={index} className="relative">
                                                    <CardDisplay cardString={card} isLarge={false} />
                                                    <button
                                                        onClick={() => handleRemoveCard(card, setTempBadBeatSelection)}
                                                        className="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold"
                                                    >
                                                        X
                                                    </button>
                                                </div>
                                            ))
                                        ) : (
                                            <p className={`${placeholderColorClass}`}>Select 5 cards below to build the qualification hand.</p>
                                        )}
                                    </div>

                                    {/* Card Selection Grid for Bad Beat Hand */}
                                    {tempBadBeatSelection.length < 5 && (
                                        <>
                                            <div className="mb-4">
                                                <p className={`${subtextColorClass} text-sm mb-2`}>Select Rank:</p>
                                                <div className="flex flex-wrap gap-2 justify-center">
                                                    {ranks.map(rank => {
                                                        const isDisabled = tempBadBeatSelection.length >= 5 || (badBeatSelectedSuit && tempBadBeatSelection.includes(rank + badBeatSelectedSuit));
                                                        return (
                                                            <button
                                                                key={rank}
                                                                onClick={() => setBadBeatSelectedRank(rank)}
                                                                className={`px-3 py-1 rounded-md text-sm font-semibold
                                                                    ${badBeatSelectedRank === rank ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800'}
                                                                    ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'}
                                                                `}
                                                                disabled={isDisabled}
                                                            >
                                                                {rank}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            <div>
                                                <p className={`${subtextColorClass} text-sm mb-2`}>Select Suit:</p>
                                                <div className="flex flex-wrap gap-2 justify-center">
                                                    {suits.map(suit => {
                                                        const isDisabled = tempBadBeatSelection.length >= 5 || (badBeatSelectedRank && tempBadBeatSelection.includes(badBeatSelectedRank + suit));
                                                        return (
                                                            <button
                                                                key={suit}
                                                                onClick={() => setBadBeatSelectedSuit(suit)}
                                                                className={`px-3 py-1 rounded-md text-sm font-semibold
                                                                    ${badBeatSelectedSuit === suit ? 'bg-blue-600 text-white' : `${inputBgClass} ${suitDisplayInfo[suit].color}`} border ${inputBorderClass}
                                                                    ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'}
                                                                `}
                                                                disabled={isDisabled}
                                                            >
                                                                {suitDisplayInfo[suit].symbol}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                            <button
                                                onClick={handleAddBadBeatCard}
                                                disabled={!badBeatSelectedRank || !badBeatSelectedSuit || tempBadBeatSelection.includes(`${badBeatSelectedRank}${badBeatSelectedSuit}`) || tempBadBeatSelection.length >= 5}
                                                className="px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md disabled:opacity-50 disabled:cursor-not-allowed mt-4"
                                            >
                                                Add Card
                                            </button>
                                        </>
                                    )}

                                    <div className="mt-4 flex justify-center space-x-4">
                                        <button onClick={handleConfirmBadBeatHand} disabled={tempBadBeatSelection.length !== 5} className="px-5 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                                            Confirm Hand
                                        </button>
                                        <button onClick={() => {
                                            handleClearSelectionAndStates(setTempBadBeatSelection, setBadBeatSelectedRank, setBadBeatSelectedSuit);
                                            setShowBadBeatHandSelector(false);
                                        }} className="px-5 py-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold rounded-lg shadow-md">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    <audio ref={audioRef} src="https://quicksounds.com/uploads/tracks/1098360932_1903340572_1377612226.mp3" preload="auto"></audio>
                </div>
            );
        };

        /**
         * Main App Component
         * Manages the overall application view state (home, highHand, tournament)
         * and common settings like theme.
         */
        function App() {
  console.log("App component rendering");
  const [currentView, setCurrentView] = useState(() => localStorage.getItem('pokerAppCurrentView') || 'home');
  const [theme, setTheme] = useState('dark');

  useEffect(() => {
    const savedTheme = localStorage.getItem('pokerTimerTheme') || 'dark';
    setTheme(savedTheme);
  }, []);

  useEffect(() => {
    localStorage.setItem('pokerTimerTheme', theme);
    localStorage.setItem('pokerAppCurrentView', currentView);
  }, [theme, currentView]);

  useEffect(() => {
    document.documentElement.classList.remove('light', 'dark');
    document.documentElement.classList.add(theme);
  }, [theme]);

  const appBgClass = theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-900';
  const mainCardBgClass = theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100';
  const sectionBgClass = theme === 'dark' ? 'bg-gray-600' : 'bg-gray-200';
  const inputBgClass = theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100';
  const inputBorderClass = theme === 'dark' ? 'border-gray-600' : 'border-gray-300';
  const subtextColorClass = theme === 'dark' ? 'text-gray-300' : 'text-gray-600';
  const placeholderColorClass = theme === 'dark' ? 'text-gray-400' : 'text-gray-500';
  const headingTextColorClass = theme === 'dark' ? 'text-yellow-400' : 'text-blue-700';

  const handleSelectMode = (mode) => {
    setCurrentView(mode);
  };

  // If you still need this helper, keep it as a separate function
  const generateSmallTournament = (speed) => {
    if (!tempPlayersRange) return;
    const [minP, maxP] = tempPlayersRange;

    const highestChip = chipDenominations.length > 0
      ? Math.max(...chipDenominations.map(c => c.value))
      : 100;

    const maxBigBlind = highestChip * 10;

    let duration, stack, breakEvery;
    if (speed === 'turbo')       { duration = 8;  stack = 8000;  breakEvery = 6; }
    else if (speed === 'regular'){ duration = 12; stack = 15000; breakEvery = 5; }
    else                         { duration = 18; stack = 25000; breakEvery = 4; }

    const newLevels = [];
    let sb = highestChip;
    let bb = highestChip * 2;
    let ante = 0;
    let levelCount = 0;

    while (levelCount < 20 && bb <= maxBigBlind) {
      levelCount++;

      if (levelCount > 1 && (levelCount - 1) % breakEvery === 0) {
        newLevels.push({
          id: crypto.randomUUID(),
          sb: 0, bb: 0, ante: 0,
          duration: 15,
          isBreak: true,
          name: "Break"
        });
      }

      if (levelCount > 8)  ante = bb;
      if (levelCount > 14) ante = Math.round(bb * 1.5);

      newLevels.push({
        id: crypto.randomUUID(),
        sb,
        bb,
        ante: Math.round(ante),
        duration,
        isBreak: false
      });

      const multiplier = levelCount < 8 ? 2 : (levelCount < 14 ? 2.5 : 2);
      sb = Math.round(sb * multiplier / highestChip) * highestChip;
      bb = sb * 2;

      if (bb > maxBigBlind) break;
    }

    while (newLevels.length > 0 && newLevels[newLevels.length - 1].bb > maxBigBlind) {
      newLevels.pop();
    }

    setLevels(newLevels);
    setTempPlayersRange(null);
    alert(`Generated ${speed.toUpperCase()} tournament for ${minP}–${maxP} players!\n` +
          `Starting stack: ${stack.toLocaleString()}\n` +
          `Max blind: ${maxBigBlind.toLocaleString()} (10× highest chip)`);
  };

  const renderView = () => {
    switch (currentView) {
      case 'home':
        return (
          <HomeView
            onSelectMode={handleSelectMode}
            theme={theme}
            headingTextColorClass={headingTextColorClass}
            mainCardBgClass={mainCardBgClass}
          />
        );
      case 'highHand':
        return (
          <HighHandTimerView
            theme={theme}
            appBgClass={appBgClass}
            mainCardBgClass={mainCardBgClass}
            sectionBgClass={sectionBgClass}
            inputBgClass={inputBgClass}
            inputBorderClass={inputBorderClass}
            subtextColorClass={subtextColorClass}
            placeholderColorClass={placeholderColorClass}
            headingTextColorClass={headingTextColorClass}
            onBackToHome={() => setCurrentView('home')}
            onThemeChange={setTheme}
          />
        );
      case 'tournament':
        return (
          <TournamentClockView
            theme={theme}
            appBgClass={appBgClass}
            mainCardBgClass={mainCardBgClass}
            sectionBgClass={sectionBgClass}
            inputBgClass={inputBgClass}
            inputBorderClass={inputBorderClass}
            subtextColorClass={subtextColorClass}
            placeholderColorClass={placeholderColorClass}
            headingTextColorClass={headingTextColorClass}
            onBackToHome={() => setCurrentView('home')}
            onThemeChange={setTheme}
          />
        );
      default:
        return (
          <HomeView
            onSelectMode={handleSelectMode}
            theme={theme}
            headingTextColorClass={headingTextColorClass}
            mainCardBgClass={mainCardBgClass}
          />
        );
    }
  };

  return (
    <div className={`min-h-screen flex flex-col items-center justify-center p-4 font-inter transition-colors duration-500 ${appBgClass}`}>
      {renderView()}
    </div>
  );
}


        // Mount the React app after the entire window has loaded
        window.onload = function() {
            console.log("window.onload triggered.");
            const container = document.getElementById('root');
            if (!container) {
                console.error("Root element with ID 'root' not found in the DOM.");
                document.body.innerHTML = `<div style="color: red; padding: 20px; font-family: sans-serif;">
                    <h3>Application Error</h3>
                    <p>The application could not start because the root element was not found.</p>
                    <p>Please ensure there is a &lt;div id="root"&gt;&lt;/div&gt; in your HTML body.</p>
                </div>`;
                return;
            }

            console.log("Root container found.");

            let attempts = 0;
            const maxAttempts = 50; // Try for up to 5 seconds (50 * 100ms)
            const intervalTime = 100; // Check every 100ms

            const tryMountApp = () => {
                // Check for both window.React and window.ReactDOM
                if (window.React && window.ReactDOM && typeof window.ReactDOM.createRoot === 'function') {
                    console.log(`React and ReactDOM are available after ${attempts} attempts. Attempting to mount.`);
                    try {
                        window.ReactDOM.createRoot(container).render(<App />);
                        console.log("React app mounted successfully.");
                    } catch (mountError) {
                        console.error("Error mounting React app:", mountError);
                        container.innerHTML = `<div style="color: red; padding: 20px; font-family: sans-serif;">
                            <h3>Application Error</h3>
                            <p>An error occurred while rendering the React app: ${mountError.message}</p>
                            <p>Please check the console for more details.</p>
                        </div>`;
                    }
                } else {
                    attempts++;
                    if (attempts < maxAttempts) {
                        console.log(`ReactDOM not yet available (attempt ${attempts}). Retrying in ${intervalTime}ms...`, {
                            reactGlobal: typeof window.React,
                            reactDOMGlobal: typeof window.ReactDOM,
                            createRootProp: typeof (window.ReactDOM ? window.ReactDOM.createRoot : 'N/A')
                        });
                        setTimeout(tryMountApp, intervalTime);
                    } else {
                        console.error("ReactDOM not fully loaded or createRoot not available after multiple attempts. Aborting.", {
                            reactGlobal: typeof window.React,
                            reactDOMGlobal: typeof window.ReactDOM,
                            createRootProp: typeof (window.ReactDOM ? window.ReactDOM.createRoot : 'N/A')
                        });
                        container.innerHTML = `<div style="color: red; padding: 20px; font-family: sans-serif;">
                            <h3>Application Error</h3>
                            <p>React libraries did not load correctly within the expected timeframe.</p>
                            <p>Please try refreshing the page or contact support if the issue persists.</p>
                        </div>`;
                    }
                }
            };

            // Start the polling
            tryMountApp();
        };
    </script>
</body>
</html>
